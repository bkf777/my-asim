"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[8429],{48429:function(e,t,a){a.r(t),a.d(t,{PickerControlRenderer:function(){return F},default:function(){return O}});var n=a(31635),i=a(96540),o=a(32485),r=a.n(o),s=a(90179),l=a.n(s),d=a(7309),c=a.n(d),p=a(2404),u=a.n(p),m=a(24713),_=a.n(m),h=a(55364),v=a.n(h),g=a(5917),y=a(25627),f=a(80191),C=a.n(f),k=a(66283),b=a(22451),O=function(e){function t(t){var a=e.call(this,t)||this;a.state={isOpened:!1,schema:a.buildSchema(a.props),isFocused:!1},a.input=i.createRef(),a.toDispose=[],a.mounted=!1;var o=t.formInited,r=t.addHook,s=t.formItem,l=function(){return(0,n.__awaiter)(a,void 0,void 0,function(){var e=this;return(0,n.__generator)(this,function(t){switch(t.label){case 0:return[4,this.fetchOptions()];case 1:return t.sent(),this.mounted&&this.toDispose.push((0,b.reaction)(function(){return JSON.stringify(null==s?void 0:s.tmpValue)},function(){return e.fetchOptions()})),[2]}})})};return s&&a.toDispose.push(o||!r?s.addInitHook(l):r(l,"init")),a}return(0,n.__extends)(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentDidUpdate=function(e){var t,a=this.props;["multiple","source","pickerSchema"].some(function(t){return!u()(e[t],a[t])})?this.setState({schema:this.buildSchema(a)}):(0,g.B92)(e.source,a.source,e.data,a.data)&&(null===(t=a.formItem)||void 0===t?void 0:t.inited)&&this.fetchOptions()},t.prototype.componentWillUnmount=function(){this.toDispose.forEach(function(e){return e()}),this.toDispose=[],this.mounted=!1},t.prototype.fetchOptions=function(){var e,t,a=this.props,n=a.value,i=a.formItem,o=a.valueField,r=a.labelField,s=a.source,l=a.data;if(s&&i&&(o||"value")!==(r||"label")&&(!(t=i.getSelectedOptions(n))||t.length&&t[0][o||"value"]===t[0][r||"label"])){var d=(0,g.ed2)(l,((e={value:n})[o||"value"]=n,e.op="loadOptions",e));if((0,g.joH)(s))i.setOptions((0,g.GvO)(s,l,"| raw"));else if((0,g.Amo)(s,d))return i.loadOptions(s,d,{autoAppend:!0})}},t.prototype.buildSchema=function(e){var t,a,i=(0,g.joH)(e.source);return(0,n.__assign)((0,n.__assign)({checkOnItemClick:!0,listItem:{title:"${".concat(e.labelField||"label","|raw}")}},e.pickerSchema),{labelTpl:null!==(a=null===(t=e.pickerSchema)||void 0===t?void 0:t.labelTpl)&&void 0!==a?a:e.labelTpl,type:"crud",pickerMode:!0,syncLocation:!1,filterCanAccessSuperData:!1,api:i?null:e.source,source:i?e.source:null,keepItemSelectionOnPageChange:!0,valueField:e.valueField,labelField:e.labelField,bulkActions:e.multiple?e.pickerSchema.bulkActions:[]})},t.prototype.crudRef=function(e){for(;e&&e.getWrappedInstance;)e=e.getWrappedInstance();this.crud=e},t.prototype.reload=function(){if(this.crud)this.crud.search();else{var e=this.props.reloadOptions;e&&e()}},t.prototype.open=function(){this.setState({isOpened:!0})},t.prototype.close=function(){this.setState({isOpened:!1})},t.prototype.handleModalConfirm=function(e,t,a,i){return(0,n.__awaiter)(this,void 0,void 0,function(){var t;return(0,n.__generator)(this,function(a){switch(a.label){case 0:return t=_()(i,function(e){return"crud"===e.props.type}),[4,this.handleChange(e[t].items)];case 1:return a.sent(),this.close(),[2]}})})},t.prototype.handleChange=function(e){return(0,n.__awaiter)(this,void 0,void 0,function(){var t,a,i,o,r,s,l,d,p,u,m,_,h,v;return(0,n.__generator)(this,function(n){switch(n.label){case 0:return t=this.props,a=t.joinValues,i=t.valueField,o=t.delimiter,r=t.extractValue,s=t.multiple,l=t.options,t.data,d=t.dispatchEvent,t.selectedOptions,p=t.setOptions,u=t.onChange,m=e,m=a?e.map(function(e){return e[i||"value"]}).join(o||","):r?s?e.map(function(e){return e[i||"value"]}):e[0]&&e[0][i||"value"]||"":s?e:e[0],_=[],e.forEach(function(e){c()(l,function(t){return e[i||"value"]==t[i||"value"]})||_.push(e)}),_.length&&p(l.concat(_)),h=s?e:e[0],[4,d("change",(0,g.RKM)(this.props,{value:m,option:h,selectedItems:h}))];case 1:return(null==(v=n.sent())?void 0:v.prevented)||u(m),[2]}})})},t.prototype.handleItemClick=function(e){return(0,n.__awaiter)(this,void 0,void 0,function(){var t,a,i;return(0,n.__generator)(this,function(n){switch(n.label){case 0:return t=this.props,a=t.data,[4,(0,t.dispatchEvent)("itemClick",(0,g.ed2)(a,{item:e}))];case 1:return null==(i=n.sent())||i.prevented,[2]}})})},t.prototype.removeItem=function(e){return(0,n.__awaiter)(this,void 0,void 0,function(){var t,a,i,o,r,s,l,d,c,p,u,m,_,h;return(0,n.__generator)(this,function(v){switch(v.label){case 0:return t=this.props,a=t.selectedOptions,i=t.joinValues,o=t.extractValue,r=t.delimiter,s=t.valueField,l=t.onChange,d=t.multiple,c=t.dispatchEvent,p=a.concat(),u=(0,n.__read)(p.splice(e,1),1),m=u[0],_=p,_=i?p.map(function(e){return e[s||"value"]}).join(r||","):o?d?p.map(function(e){return e[s||"value"]}):p[0]&&p[0][s||"value"]||"":d?p:p[0],[4,c("change",(0,g.RKM)(this.props,{value:_,option:m,selectedItems:m}))];case 1:return(null==(h=v.sent())?void 0:h.prevented)||l(_),[2]}})})},t.prototype.handleKeyDown=function(e){var t=this.props.selectedOptions;" "===e.key?(this.open(),e.preventDefault()):t.length&&"Backspace"==e.key&&this.removeItem(t.length-1)},t.prototype.handleFocus=function(e){this.input.current&&this.input.current.focus(),e.stopPropagation(),this.setState({isFocused:!0})},t.prototype.handleBlur=function(){this.setState({isFocused:!1})},t.prototype.handleClick=function(){this.open()},t.prototype.clearValue=function(e){e.stopPropagation();var t=this.props,a=t.onChange,n=t.resetValue;a(void 0!==n?n:"")},t.prototype.getOverflowConfig=function(){var e=this.props.overflowConfig;return v()(t.defaultProps.overflowConfig,e)},t.prototype.handleSelect=function(e,t){var a=this.props,n=a.selectedOptions,i=a.valueField;if(Array.isArray(e)&&Array.isArray(t)&&(e.length||t.length)){var o=C()(e,n,function(e,t){var a=e[i||"value"],n=t[i||"value"];return a||n?a===n:u()(l()(e,"value"),l()(t,"value"))});o.length===e.length&&o.length===n.length||this.handleChange(e)}},t.prototype.renderTag=function(e,t){var a=this,o=this.props,r=o.itemClearable,s=void 0===r||r,l=o.classPrefix,d=o.classnames,c=o.labelField,p=o.labelTpl,u=(o.translate,o.disabled),m=o.env,_=o.id,h=o.themeCss,v=o.css;return i.createElement("div",{key:t,className:d("".concat(l,"Picker-value"),(0,g.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"pickValueWrapClassName",id:_,themeCss:h||v})),{"is-disabled":u})},s&&i.createElement("span",{className:d("".concat(l,"Picker-valueIcon"),(0,g.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"pickValueIconClassName",id:_,themeCss:h||v}))),onClick:function(e){e.stopPropagation(),a.removeItem(t)}},"×"),i.createElement(y.Fo,{inline:!1,tooltip:(0,g.dnO)(e,c||"label")},i.createElement("span",{className:d("".concat(l,"Picker-valueLabel"),(0,g.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"pickFontClassName",id:_,themeCss:h||v}))),onClick:function(t){t.stopPropagation(),a.handleItemClick(e)}},p?i.createElement(y.Ed,{html:(0,g.pbD)(p,e),filterHtml:m.filterHtml}):"".concat((0,g.dnO)(e,c||"label")||(0,g.dnO)(e,"id")))))},t.prototype.renderValues=function(){var e=this,t=this.props,a=t.classPrefix,o=t.selectedOptions,s=t.translate,d=t.disabled,c=t.multiple,p=t.popOverContainer,u=t.id,m=t.themeCss,_=t.css,h=this.getOverflowConfig(),v=h.maxTagCount,f=h.overflowTagPopover,C=o.length,k=o,b=!1!==c&&(0,g.z09)(v,{start:0,end:C,left:"inclusive",right:"exclusive"});return b&&(k=(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(o.slice(0,v)),!1),[{label:"+ ".concat(C-v," ..."),value:"__overflow_tag__"}],!1)),i.createElement(i.Fragment,null,k.map(function(t,c){return b&&c===v?i.createElement(y.T_,{key:c,container:p,tooltip:(0,n.__assign)((0,n.__assign)({tooltipClassName:r()("Picker-overflow",null==f?void 0:f.tooltipClassName),title:s("已选项")},l()(f,["children","content","tooltipClassName"])),{children:function(){return i.createElement("div",{className:r()("".concat(a,"Picker-overflow-wrapper"))},o.slice(v,C).map(function(t,a){var n=a+v;return e.renderTag(t,n)}))}})},i.createElement("div",{key:c,className:r()("".concat(a,"Picker-value"),{"is-disabled":d})},i.createElement("span",{className:"".concat(a,"Picker-valueLabel ").concat((0,g.NH8)((0,n.__assign)((0,n.__assign)({},e.props),{name:"pickFontClassName",id:u,themeCss:m||_})))},t.label))):e.renderTag(t,c)}))},t.prototype.overrideCRUDProps=function(){return{}},t.prototype.renderBody=function(e){var t=(void 0===e?{}:e).popOverContainer,a=this.props,i=a.render,o=a.selectedOptions,r=a.options,s=a.multiple,l=a.valueField,d=a.embed,c=a.source,p=a.strictMode,u=a.testIdBuilder,m=this.getOverflowConfig(),_=m.maxTagCount,h=m.overflowTagPopoverInCRUD,v=m.displayPosition;return i("modal-body",this.state.schema,(0,n.__assign)((0,n.__assign)({value:o,valueField:l,primaryField:l,options:c?[]:r,multiple:s,strictMode:p,onSelect:d?this.handleSelect:void 0,testIdBuilder:null==u?void 0:u.getChild("body-schema"),ref:this.crudRef,popOverContainer:t},d||Array.isArray(v)&&v.includes("crud")?{maxTagCount:_,overflowTagPopover:h}:{}),this.overrideCRUDProps()))},t.prototype.render=function(){var e=this.props,t=e.className,a=(e.style,e.modalClassName),o=e.classnames,r=e.disabled,s=e.render,l=e.modalMode,d=e.source,c=e.size,p=e.clearable,u=e.multiple,m=e.placeholder,_=e.embed,h=e.selectedOptions,v=e.translate,f=e.popOverContainer,C=e.modalTitle,k=e.data,b=e.mobileUI,O=e.env,F=e.themeCss,P=e.css,w=e.id,N=e.classPrefix,I=e.testIdBuilder;return i.createElement("div",{className:o("PickerControl",{"is-mobile":b},t)},_?i.createElement("div",{className:o("Picker")},this.renderBody({popOverContainer:f})):i.createElement("div",{className:o("Picker",{"Picker--single":!u,"Picker--multi":u,"is-focused":this.state.isFocused,"is-disabled":r})},i.createElement("div",{onClick:this.handleClick,className:o("Picker-input",r&&"is-disabled",this.state.isFocused&&"is-focused",(0,g.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"pickControlClassName",id:w,themeCss:F||P})))},!h.length&&m?i.createElement("div",{className:o("Picker-placeholder")},v(m)):i.createElement("div",(0,n.__assign)({className:o("Picker-valueWrap")},null==I?void 0:I.getTestId()),this.renderValues(),i.createElement("input",{onChange:g.lQ1,value:"",ref:this.input,onKeyDown:this.handleKeyDown,onClick:this.handleFocus,onBlur:this.handleBlur,readOnly:b})),p&&!r&&h.length?i.createElement("a",{onClick:this.clearValue,className:o("Picker-clear")},i.createElement(y.In,{icon:"input-clear",className:"icon"})):null,i.createElement("span",(0,n.__assign)({onClick:this.open,className:o("Picker-btn")},null==I?void 0:I.getChild("picker-open-btn").getTestId()),i.createElement(y.In,{icon:"window-restore",className:o("icon",(0,g.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"pickIconClassName",id:w,themeCss:F||P}))),iconContent:"Picker-icon"}))),s("modal",{title:C&&"string"==typeof C?(0,g.pbD)(C,k):v("Select.placeholder"),size:c,type:l,className:a,body:{children:this.renderBody},testIdBuilder:null==I?void 0:I.getChild("modal")},{key:"modal",lazyRender:!!d,onConfirm:this.handleModalConfirm,onClose:this.close,show:this.state.isOpened})),i.createElement(g.z4D,(0,n.__assign)({},this.props,{config:{themeCss:F||P,classNames:[{key:"pickControlClassName",weights:{default:{important:!0},hover:{important:!0},focused:{important:!0,parent:".".concat(N,"Picker.is-focused >")},disabled:{important:!0,parent:".".concat(N,"Picker.is-disabled >")}}},{key:"pickFontClassName"},{key:"pickValueWrapClassName",weights:{default:{important:!0}}},{key:"pickValueIconClassName",weights:{default:{important:!0},hover:{important:!0}}},{key:"pickIconClassName",weights:{default:{suf:" svg"}}}],id:w},env:O})))},t.propsList=["modalTitle","modalMode","pickerSchema","labelField","onChange","options","value","inline","multiple","embed","resetValue","placeholder","onQuery"],t.defaultProps={modalMode:"dialog",multiple:!1,placeholder:"Picker.placeholder",labelField:"label",valueField:"value",pickerSchema:{mode:"list"},embed:!1,overflowConfig:{maxTagCount:-1,displayPosition:["select","crud"],overflowTagPopover:{placement:"top",trigger:"hover",showArrow:!1,offset:[0,-5]},overflowTagPopoverInCRUD:{placement:"bottom",trigger:"hover",showArrow:!1,offset:[0,0]}}},(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",Object)],t.prototype,"fetchOptions",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"crudRef",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"open",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"close",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Array,Object,Object,Array]),(0,n.__metadata)("design:returntype",Promise)],t.prototype,"handleModalConfirm",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Array]),(0,n.__metadata)("design:returntype",Promise)],t.prototype,"handleChange",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",Promise)],t.prototype,"handleItemClick",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"handleKeyDown",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"handleFocus",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"handleBlur",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"handleClick",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"clearValue",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Array,Array]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"handleSelect",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"overrideCRUDProps",null),(0,n.__decorate)([g.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"renderBody",null),(0,n.__decorate)([(0,k.E)(),(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"render",null),t}(i.PureComponent),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),(0,n.__decorate)([(0,g.QqA)({type:"picker",autoLoadOptionsFromSource:!1,sizeMutable:!1})],t)}(O)}}]);