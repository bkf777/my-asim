"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[3788],{33788:function(e,t,n){n.r(t),n.d(t,{ExcelControlRenderer:function(){return m},default:function(){return v}});var r=n(31635),a=n(96540),i=n(20978),o=n(90179),s=n.n(o),l=n(55364),u=n.n(l),c=n(62193),p=n.n(c),d=n(11331),h=n.n(d),f=n(5917),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={filename:""},t}return(0,r.__extends)(t,e),t.prototype.componentDidUpdate=function(e){e.value===this.props.value||this.props.value||this.setState({filename:""})},t.prototype.syncAutoFill=function(e){var t=this.props,n=t.autoFill,r=t.onBulkChange,a=t.data,i=t.name;if(!(null==n?void 0:n.hasOwnProperty("api"))&&(0,f.Gvm)(n)){var o=i?s()(n,i):n;if(!p()(o)&&r){var l=(0,f.nd1)(o,{filename:e});Object.keys(l).forEach(function(e){h()(l[e])&&h()(a[e])&&(l[e]=u()({},a[e],l[e]))}),r(l)}}},t.prototype.handleDrop=function(e){var t=this,a=e[0],i=a.name,o=new FileReader;o.readAsArrayBuffer(a),o.onload=function(){return(0,r.__awaiter)(t,void 0,void 0,function(){var e=this;return(0,r.__generator)(this,function(t){return o.result&&(i.toLowerCase().endsWith(".xls")?n.e(3959).then(n.bind(n,3959)).then(function(t){var n=t.read(new Uint8Array(o.result),{cellDates:!0}),r=t.writeXLSX(n,{type:"array"});e.processExcelFile(r,i)}):this.processExcelFile(o.result,i)),[2]})})}},t.prototype.processExcelFile=function(e,t){var a=this,i=this.props,o=i.allSheets,s=i.onChange,l=i.parseImage,u=i.autoFill;n.e(4974).then(n.t.bind(n,24974,23)).then(function(n){return(0,r.__awaiter)(a,void 0,void 0,function(){var a,i,c,p,d,h,f=this;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return a=n.default||n,this.ExcelJS=a,[4,(i=new a.Workbook).xlsx.load(e)];case 1:return r.sent(),c=[],o?i.eachSheet(function(e){"hidden"!==(e.state||"visible")&&(l?c.push({sheetName:e.name,data:f.readWorksheet(e),images:f.readImages(e,i)}):c.push({sheetName:e.name,data:f.readWorksheet(e)}))}):(p=i.worksheets.find(function(e){return"hidden"!==e.state}),l?(d=this.readImages(p,i),c={data:this.readWorksheet(p),images:d}):c=this.readWorksheet(p)),[4,this.dispatchEvent("change",c)];case 2:return(null==(h=r.sent())?void 0:h.prevented)||(s(c),u&&this.syncAutoFill(t),this.setState({filename:t})),[2]}})})})},t.prototype.readImages=function(e,t){var n,a,i=this.props.imageDataURI,o=e.getImages(),s=[];try{for(var l=(0,r.__values)(o),u=l.next();!u.done;u=l.next()){var c=u.value,p=t.getImage(+c.imageId),d=this.encodeBase64Bytes(p.buffer);if(i){var h=p.extension||"png";s.push("data:image/".concat(h,";base64,")+d)}else s.push(d)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return s},t.prototype.encodeBase64Bytes=function(e){return btoa(e.reduce(function(e,t){return e+String.fromCharCode(t)},""))},t.prototype.dispatchEvent=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=this.props,a=n.dispatchEvent,n.data,[4,a(e,(0,f.RKM)(this.props,{value:t}))];case 1:return[2,r.sent()]}})})},t.prototype.isRichTextValue=function(e){return!!(e&&(0,f.Gvm)(e)&&e.hasOwnProperty("richText")&&Array.isArray(null==e?void 0:e.richText))},t.prototype.richText2PlainString=function(e,t){return void 0===t&&(t=!1),e.richText.map(function(e){var n=e.text,r=e.font,a=void 0===r?{}:r,i=n;if(t){var o="",s=(null==a?void 0:a.bold)?"strong":(null==a?void 0:a.italic)?"em":"superscript"===(null==a?void 0:a.vertAlign)?"sup":"subscript"===(null==a?void 0:a.vertAlign)?"sub":"span";(null==a?void 0:a.strike)?o+="text-decoration: line-through;":(null==a?void 0:a.underline)&&(o+="text-decoration: underline;"),(null==a?void 0:a.outline)&&(o+="outline: solid;"),(null==a?void 0:a.size)&&(o+="font-size: ".concat(a.size,"px;")),i="<".concat(s," ").concat(o?"style=".concat(o):"",">").concat(n,"</").concat(s,">")}return i}).join("")},t.prototype.readWorksheet=function(e){var t=this,n=[],r=this.props,a=r.parseMode,i=r.plainText,o=r.includeEmpty;if("array"===a)return e.eachRow(function(e,r){var a=e.values;a.shift(),i&&(a=a.map(function(e){if(e instanceof Object){if(e.hyperlink)return e.hyperlink.startsWith("mailto:")?e.hyperlink.substring(7):e.hyperlink;if(e.result)return e.result;if(e.richText)return t.richText2PlainString(e)}return e})),n.push(a)}),n;var s=[];return e.eachRow(function(e,r){var a;if(1==r)s=(null!==(a=e.values)&&void 0!==a?a:[]).map(function(e){return t.isRichTextValue(e)?t.richText2PlainString(e):e});else{var l={};o&&s.forEach(function(e){l[e]=""}),e.eachCell(function(e,n){if(s[n]){var r=e.value;if(i){var a=t.ExcelJS.ValueType;e.type===a.Hyperlink?(r=e.value.hyperlink).startsWith("mailto:")&&(r=r.substring(7)):e.type===a.Formula?r=e.value.result:e.type===a.RichText?r=t.richText2PlainString(e.value):e.type===a.Error&&(r="")}l[s[n]]=r}}),n.push(l)}}),n},t.prototype.doAction=function(e,t,n){var r,a,i=null==e?void 0:e.actionType,o=this.props,s=o.onChange,l=o.resetValue,u=o.formStore,c=o.store,p=o.name;if("clear"===i)s("");else if("reset"===i){var d=null!==(a=(0,f.dnO)(null!==(r=null==u?void 0:u.pristine)&&void 0!==r?r:null==c?void 0:c.pristine,p))&&void 0!==a?a:l;s(null!=d?d:"")}},t.prototype.render=function(){var e=this,t=this.props,n=t.className,o=t.classnames,s=(t.classPrefix,t.disabled),l=t.translate,u=t.placeholder,c=t.testIdBuilder;return a.createElement("div",{className:o("ExcelControl",n)},a.createElement(i.Ay,{key:"drop-zone",onDrop:this.handleDrop,accept:".xlsx,.xls",multiple:!1,disabled:s},function(t){var i=t.getRootProps,s=t.getInputProps;return a.createElement("section",{className:o("ExcelControl-container",n)},a.createElement("div",(0,r.__assign)({},i({className:o("ExcelControl-dropzone")}),null==c?void 0:c.getTestId()),a.createElement("input",(0,r.__assign)({},s(),null==c?void 0:c.getChild("input").getTestId())),e.state.filename?l("Excel.parsed",{filename:e.state.filename}):a.createElement("p",null,null!=u?u:l("Excel.placeholder"))))}))},t.defaultProps={allSheets:!1,parseMode:"object",includeEmpty:!0,plainText:!0,parseImage:!1,imageDataURI:!0},(0,r.__decorate)([f.d6t,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[String]),(0,r.__metadata)("design:returntype",void 0)],t.prototype,"syncAutoFill",null),(0,r.__decorate)([f.d6t,(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[Array]),(0,r.__metadata)("design:returntype",void 0)],t.prototype,"handleDrop",null),t}(a.PureComponent),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),(0,r.__decorate)([(0,f.eIh)({type:"input-excel"})],t)}(v)}}]);