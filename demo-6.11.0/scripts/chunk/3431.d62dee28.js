"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[3431],{23431:function(e,t,a){a.r(t),a.d(t,{SubFormControlRenderer:function(){return f},default:function(){return v}});var n,i=a(31635),s=a(96540),o=a(5917),r=a(32485),l=a.n(r),d=a(90179),m=a.n(d),c=a(44383),p=a.n(c),u=a(25627),h=a(10246),g=a(40961),b=function(e){return e?((n=n||document.createElement("div")).innerHTML=e,n.innerText):e},v=function(e){function t(t){var a=e.call(this,t)||this;return a.state={},a.id=(0,o.OsD)(),a.addItem=a.addItem.bind(a),a.removeItem=a.removeItem.bind(a),a.editSingle=a.editSingle.bind(a),a.open=a.open.bind(a),a.close=a.close.bind(a),a.dragTipRef=a.dragTipRef.bind(a),a.handleDialogConfirm=a.handleDialogConfirm.bind(a),a}return(0,i.__extends)(t,e),t.prototype.addItem=function(){this.setState({dialogData:(0,o.ed2)(this.props.data,this.props.scaffold||{}),dialogCtx:{mode:"add"}})},t.prototype.removeItem=function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.currentTarget.getAttribute("data-index"),10),a=this.props.value;Array.isArray(a)&&((a=a.concat()).splice(t,1),this.props.onChange(a))},t.prototype.editSingle=function(){this.props.value?this.setState({dialogData:(0,o.ed2)(this.props.data,this.props.value),dialogCtx:{mode:"edit"}}):this.addItem()},t.prototype.open=function(e){var t=parseInt(e.currentTarget.getAttribute("data-index"),10),a=this.props.value;Array.isArray(a)&&a[t]&&(this.tempValue=a[t],this.setState({dialogData:(0,o.ed2)(this.props.data,a[t]),dialogCtx:{mode:"edit",index:t}}))},t.prototype.close=function(){this.setState({dialogData:void 0,dialogCtx:void 0})},t.prototype.handleDialogConfirm=function(e){var t=this.props,a=t.multiple,n=t.onChange,s=t.value,o=this.state.dialogCtx;if(a){var r=Array.isArray(s)?s.concat():[];"add"===(null==o?void 0:o.mode)?r.push((0,i.__assign)({},e[0])):r[o.index]=(0,i.__assign)((0,i.__assign)({},r[o.index]),e[0]),n(r)}else n((0,i.__assign)((0,i.__assign)({},s),e[0]));this.close()},t.prototype.handlePopupConfirm=function(){var e=this.tempValue,t=this.props,a=t.multiple,n=t.onChange,s=t.value,o=this.state.dialogCtx;if(a){var r=Array.isArray(s)?s.concat():[];"add"===(null==o?void 0:o.mode)?r.push((0,i.__assign)({},e)):r[o.index]=(0,i.__assign)((0,i.__assign)({},r[o.index]),e),n(r)}else n((0,i.__assign)((0,i.__assign)({},s),e));this.close()},t.prototype.dragTipRef=function(e){!this.dragTip&&e?this.initDragging():this.dragTip&&!e&&this.destroyDragging(),this.dragTip=e},t.prototype.initDragging=function(){var e=this,t=this.props.classPrefix,a=this.props.submitOnChange,n=(0,g.findDOMNode)(this);this.sortable=new h.Ay(n.querySelector(".".concat(t,"SubForm-values")),{group:"SubForm-".concat(this.id),animation:150,handle:".".concat(t,"SubForm-valueDragBar"),ghostClass:"".concat(t,"SubForm-value--dragging"),onEnd:function(t){if(t.newIndex!==t.oldIndex){var n=t.to;t.oldIndex<n.childNodes.length-1?n.insertBefore(t.item,n.childNodes[t.oldIndex>t.newIndex?t.oldIndex+1:t.oldIndex]):n.appendChild(t.item);var i=e.props.value;if(Array.isArray(i)){var s=i.concat();s.splice(t.newIndex,0,s.splice(t.oldIndex,1)[0]),e.props.onChange(s,a,!0)}}}})},t.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy()},t.prototype.buildDialogSchema=function(){var e=this.props.form,t=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return(0,i.__assign)((0,i.__assign)({},p()(e,t)),{type:"dialog",body:(0,i.__assign)((0,i.__assign)({type:"form",canAccessSuperData:!1},m()(e,t)),{inheritData:!1})})},t.prototype.buildFormSchema=function(){var e=this.props.form;return(0,i.__assign)((0,i.__assign)({type:"form",canAccessSuperData:!1},m()(e,["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"])),{inheritData:!1})},t.prototype.renderMultipe=function(){var e=this,t=this.props,a=t.addButtonClassName,n=t.itemClassName,r=t.itemsClassName,l=t.disabled,d=t.maxLength,m=t.labelField,c=t.defaultLabel,p=t.value,h=t.btnLabel,g=t.render,v=t.data,f=t.translate,y=t.classnames,_=t.placeholder,C=t.draggable,S=t.draggableTip,N=t.addable,x=t.removable,I=t.minLength,E=t.addButtonText,F=t.testIdBuilder;return s.createElement(s.Fragment,null,Array.isArray(p)&&p.length?s.createElement("div",{className:y("SubForm-values",r),key:"values"},p.map(function(t,a){return s.createElement("div",(0,i.__assign)({className:y("SubForm-value",{"is-disabled":l},n),key:a},null==F?void 0:F.getChild("item-".concat(a)).getTestId()),C&&p.length>1?s.createElement("a",{className:y("SubForm-valueDragBar")},s.createElement(u.In,{icon:"drag-bar",className:y("icon")})):null,s.createElement("span",{className:y("SubForm-valueLabel")},h&&g("label",{type:"tpl",tpl:f(h)},{data:(0,o.ed2)(v,t)}),!h&&(t&&m&&t[m]&&b(t[m])||f(c))),s.createElement("a",{"data-index":a,onClick:e.open,className:y("SubForm-valueEdit")},s.createElement(u.In,{icon:"pencil",className:"icon"})),l||!1===x||I&&!(p.length>I)?null:s.createElement("a",{"data-index":a,className:y("SubForm-valueDel"),onClick:e.removeItem},s.createElement(u.In,{icon:"close",className:"icon"})))})):s.createElement("div",{className:y("SubForm-placeholder"),key:"placeholder"},f(_||"placeholder.empty")),s.createElement("div",{key:"toolbar",className:y("SubForm-toolbar")},!1!==N?s.createElement("button",(0,i.__assign)({type:"button",onClick:this.addItem,className:y("Button SubForm-addBtn",a),disabled:l||!!(d&&Array.isArray(p)&&p.length>=d)},null==F?void 0:F.getChild("add-button").getTestId()),s.createElement(u.In,{icon:"plus",className:"icon"}),s.createElement("span",null,f(E||"SubForm.add"))):null,C&&Array.isArray(p)&&p.length>1?s.createElement("span",{className:y("Combo-dragableTip"),ref:this.dragTipRef},Array.isArray(p)&&p.length>1?f(S):""):null))},t.prototype.renderSingle=function(){var e=this.props,t=e.classnames,a=e.itemsClassName,n=e.itemClassName,r=e.disabled,l=e.value,d=e.labelField,m=e.defaultLabel,c=e.btnLabel,p=e.render,h=e.data,g=e.translate,v=e.testIdBuilder,f=null==v?void 0:v.getChild("edit-single");return s.createElement("div",{className:t("SubForm-values",a),key:"values"},s.createElement("div",(0,i.__assign)({className:t("SubForm-value",{"is-disabled":r},n),onClick:this.editSingle,"data-tooltip":g("SubForm.editDetail"),"data-position":"bottom"},null==f?void 0:f.getTestId()),s.createElement("span",{className:t("SubForm-valueLabel")},c&&p("label",{type:"tpl",tpl:g(c)},{data:(0,o.ed2)(h,l)}),!c&&(l&&d&&l[d]&&b(l[d])||g(m))),s.createElement("a",(0,i.__assign)({className:t("SubForm-valueEdit")},null==f?void 0:f.getChild("icon").getTestId()),s.createElement(u.In,{icon:"pencil",className:"icon"}))))},t.prototype.render=function(){var e=this,t=this.props,a=t.multiple,n=t.classPrefix,i=t.className,o=(t.style,t.render),r=t.mobileUI,d=t.env,m=t.popOverContainer,c=this.state.dialogData,p=this.state.dialogCtx;return s.createElement("div",{className:l()("".concat(n,"SubFormControl"),i)},a?this.renderMultipe():this.renderSingle(),r?s.createElement(u.HH,{isShow:!!p,showConfirm:!0,onConfirm:this.handlePopupConfirm,onHide:this.close,container:r?null==d?void 0:d.getModalContainer:m||d.getModalContainer},s.createElement("div",{className:"flex-1 pl-10 pr-10"},o("form",this.buildFormSchema(),{data:c,formStore:void 0,wrapWithPanel:!1,onChange:function(t){e.tempValue=t}}))):o("modal",this.buildDialogSchema(),{show:!!p,onClose:this.close,onConfirm:this.handleDialogConfirm,data:c,formStore:void 0}))},t.defaultProps={minLength:0,maxLength:0,multiple:!1,btnClassName:"",addButtonClassName:"",itemClassName:"",labelField:"label",defaultLabel:"SubForm.button",placeholder:"placeholder.empty"},t.propsList=["form","formStore"],(0,i.__decorate)([o.d6t,(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[]),(0,i.__metadata)("design:returntype",void 0)],t.prototype,"handlePopupConfirm",null),t}(s.PureComponent),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),(0,i.__decorate)([(0,o.eIh)({type:"input-sub-form",sizeMutable:!1,strictMode:!1})],t)}(v)}}]);