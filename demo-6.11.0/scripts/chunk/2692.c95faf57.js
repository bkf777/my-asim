"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[2692],{72692:function(e,t,r){r.r(t),r.d(t,{PdfView:function(){return o},PdfViewerRenderer:function(){return d},default:function(){return s}});var n=r(31635),a=r(96540),i=r(5917),o=a.lazy(function(){return r.e(4785).then(r.bind(r,94785))}),s=function(e){function t(t){var r=e.call(this,t)||this;return r.wrapper=a.createRef(),r.state={inited:!1,loading:!1,error:!1},r}return(0,n.__extends)(t,e),t.prototype.componentDidMount=function(){this.wrapper.current&&this.setState({width:this.wrapper.current.clientWidth-100}),this.renderPdf()},t.prototype.componentDidUpdate=function(e){var t=this,r=this.props;((0,i.B92)(e.src,r.src,e.data,r.data)||(0,i.GvO)(r.src,r.data,"| raw")!==(0,i.GvO)(e.src,e.data,"| raw"))&&(this.abortLoad(),setTimeout(function(){t.fetchPdf()},0)),(0,i.dnO)(r.data,r.name)&&(0,i.dnO)(e.data,e.name)!==(0,i.dnO)(r.data,r.name)&&(this.abortLoad(),this.renderPdf())},t.prototype.componentWillUnmount=function(){this.abortLoad()},t.prototype.abortLoad=function(){this.fetchCancel&&(this.fetchCancel("load canceled"),this.fetchCancel=void 0),this.reader&&(this.reader.abort(),this.reader=void 0)},t.prototype.renderPdf=function(){return(0,n.__awaiter)(this,void 0,void 0,function(){var e,t,r,a;return(0,n.__generator)(this,function(n){switch(n.label){case 0:return e=this.props,t=e.src,r=e.name,a=e.data,this.setState({error:!1}),t?this.file?[3,2]:[4,this.fetchPdf()]:[3,3];case 1:n.sent(),n.label=2;case 2:return[3,5];case 3:return(0,i.dnO)(a,r)?[4,this.renderFormFile()]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.fetchPdf=function(){return(0,n.__awaiter)(this,void 0,void 0,function(){var e,t,r,a,o,s,d,c,p=this;return(0,n.__generator)(this,function(n){switch(n.label){case 0:if(e=this.props,t=e.env,r=e.src,a=e.data,e.translate,r&&("string"==typeof(s=(0,i.GvO)(r,a,"| raw"))?o=s:"object"==typeof s&&"string"==typeof s.value&&(o=s.value)),!o)return console.warn("file src is empty"),[2];this.setState({inited:!0,loading:!0,error:!1}),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,t.fetcher(o,a,{responseType:"arraybuffer",cancelExecutor:function(e){return p.fetchCancel=e}})];case 2:return d=n.sent(),this.file=d.data,this.forceUpdate(),[3,5];case 3:return c=n.sent(),this.setState({error:!0}),console.error(c),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},t.prototype.renderFormFile=function(){return(0,n.__awaiter)(this,void 0,void 0,function(){var e,t,r,a,o,s=this;return(0,n.__generator)(this,function(n){return e=this.props,t=e.name,r=e.data,a=(0,i.dnO)(r,t),this.setState({inited:!0,loading:!0}),a instanceof File&&((o=new FileReader).onload=function(e){var t=o.result;s.file=t,s.setState({loading:!1}),s.forceUpdate()},o.onerror=function(e){s.setState({error:!0})},o.readAsArrayBuffer(a),this.reader=o),[2]})})},t.prototype.renderEmpty=function(){var e=this.props,t=e.src,r=e.name;return t||r?null:a.createElement("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg"},a.createElement("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),a.createElement("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555"},"PDF viewer"))},t.prototype.renderError=function(){var e=this.props,t=e.src,r=e.translate;return this.state.error&&t?a.createElement("div",null,r("loadingFailed")+" url:"+t):null},t.prototype.renderTip=function(){return a.createElement("div",null,a.createElement("p",null,"[PdfViewer]: pdfjsWorkerSrc is required, Please set the `pdfjsWorkerSrc` in setGlobalOptions function."))},t.prototype.render=function(){var e=this.props,t=e.className,r=e.classnames,n=(e.translate,e.height),s=e.background,d=(0,i.u7$)().pdfjsWorkerSrc,c=this.state,p=c.loading,l=c.inited,u=c.error,h=Math.max(this.props.width||this.state.width,300);return a.createElement("div",{ref:this.wrapper},this.renderEmpty(),d?a.createElement(a.Suspense,{fallback:a.createElement("div",null,"...")},l&&!u?a.createElement(o,{file:this.file,loading:p,className:t,classnames:r,width:h,height:n,background:s}):null):this.renderTip(),this.renderError())},(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"abortLoad",null),(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",Promise)],t.prototype,"renderPdf",null),(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",Promise)],t.prototype,"fetchPdf",null),(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",Promise)],t.prototype,"renderFormFile",null),(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"renderEmpty",null),(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"renderError",null),(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"renderTip",null),t}(a.Component),d=function(e){function t(t,r){var n=e.call(this,t)||this;return r.registerComponent(n),n}return(0,n.__extends)(t,e),t.prototype.componentWillUnmount=function(){var t;null===(t=e.prototype.componentWillUnmount)||void 0===t||t.call(this),this.context.unRegisterComponent(this)},t.contextType=i.MzX,(0,n.__decorate)([(0,i.A49)({type:"pdf-viewer"}),(0,n.__metadata)("design:paramtypes",[Object,Object])],t)}(s)}}]);