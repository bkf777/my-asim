"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[6294],{16294:function(e,r,t){t.r(r),t.d(r,{MappingField:function(){return u},MappingFieldRenderer:function(){return c},Store:function(){return l}});var n,a=t(31635),i=t(96540),s=t(5917),o=t(25627),p=t(50346),l=s.KNR.named("MappingStore").props({fetching:!1,errorMsg:"",valueField:"value",map:p.types.frozen({})}).actions(function(e){var r=(0,p.flow)(function(r,t,n){var i,o,p;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,3,4]),e.fetching=!0,[4,r.fetcher(t,n)];case 1:if(!(i=a.sent()).ok)throw new Error(i.msg||"fetch error");return o=(0,s.bqU)(i.data),e.setMap(Array.isArray(o.options)?o.options:Array.isArray(o.items)?o.items:Array.isArray(o.records)?o.records:o),[3,4];case 2:return p=a.sent(),e.errorMsg=p.message,[3,4];case 3:return e.fetching=!1,[7];case 4:return[2]}})});return{load:r,setMap:function(r){Array.isArray(r)&&(r=r.reduce(function(r,t){if(null==t)return r;if((0,s.Gvm)(t)){var n=Object.keys(t);1===n.length||2==n.length&&n.includes("$$id")?r[(n=n.filter(function(e){return"$$id"!==e}))[0]]=t[n[0]]:n.length>1&&(r[t[e.valueField]]=t)}return r},{})),(0,s.Gvm)(r)&&(e.map=(0,a.__assign)({},r))}}}),u=(0,o.aH)(function(e){return l.create({id:(0,s.OsD)(),storeType:l.name},e.env)})(((n=function(e){function r(r){var t=e.call(this,r)||this;return r.store.syncProps(r,void 0,["valueField","map"]),t}return(0,a.__extends)(r,e),r.prototype.componentDidMount=function(){this.reload()},r.prototype.componentDidUpdate=function(e){var r=this.props,t=this.props,n=t.store,a=t.source,i=t.data;if(n.syncProps(r,e,a?["valueField"]:["valueField","map"]),(0,s.joH)(a)){var o=(0,s.GvO)(e.source,e.data,"| raw"),p=(0,s.GvO)(a,i,"| raw");o!==p&&n.setMap(p)}else(0,s.B92)(e.source,r.source,e.data,r.data)&&this.reload()},r.prototype.reload=function(){var e,r=this.props,t=r.source,n=r.data,a=r.env,i=this.props.store;if((0,s.joH)(t))i.setMap((0,s.GvO)(t,n,"| raw"));else if((0,s.Amo)(t,n)){var o=(0,s.UfW)(t,"get");o.cache=null!==(e=o.cache)&&void 0!==e?e:3e4,i.load(a,o,n)}},r.prototype.renderSingleValue=function(e,r,t){var n,a=this.props,s=a.className,o=a.style,p=a.placeholder,l=a.classnames,u=a.store,c=i.createElement("span",{className:"text-muted"},p),d=u.map,m=void 0,f=t?o:void 0;return void 0!==(e="string"==typeof e?e.trim():e)&&d&&void 0!==(m=null!==(n=this.renderValue(d,e))&&void 0!==n?n:!0===e&&d[1]?d[1]:!1===e&&d[0]?d[0]:d["*"])&&(c=this.renderViewValue(m,e)),i.createElement("span",{key:"map-".concat(r),className:l("MappingField",s),style:f},c)},r.prototype.renderViewValue=function(e,r){var t=this.props,n=t.render,i=t.itemSchema,o=t.renderViewValue,p=t.data,l=t.labelField,u=t.name;if(o)return o(e,r);if(!i){var c=e;return(0,s.Gvm)(e)&&(c=void 0===l||""===l?e.hasOwnProperty("type")?(0,a.__assign)({name:u},c):e.label:e[l||"label"]),(0,s.Gvm)(c)&&"tag"===c.type&&!(0,s.Gvm)(c.label)&&null!=c.label?n("mapping-tag",c,{value:null}):n("tpl",c)}return n("mappingItemSchema",i,(0,a.__assign)({data:(0,s.ed2)(p,(0,s.Gvm)(e)?e:{item:e})},"tag"===(null==i?void 0:i.type)?{value:null}:{}))},r.prototype.renderValue=function(e,r){var t=this.props.renderValue;return t?t(e,r):e[r]},r.prototype.render=function(){var e=this,r=this.props,t=r.style,n=r.defaultValue,a=r.data,o=(0,s.$_G)(this.props);return n&&(0,s.joH)(n)&&n===o&&(o=(0,s.GvO)(n,a,"| raw")),Array.isArray(o)?i.createElement("span",{style:t},o.map(function(r,t){return e.renderSingleValue(r,t)})):this.renderSingleValue(o,0,!0)},r}(i.Component)).defaultProps={placeholder:"-",map:{"*":"通配值"}},n)),c=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return(0,a.__extends)(r,e),r.prototype.render=function(){return i.createElement(u,(0,a.__assign)({},this.props))},(0,a.__decorate)([(0,s.A49)({type:"mapping",alias:["map"],name:"mapping"})],r)}(i.Component)}}]);