"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[9131],{79131:function(e,t,n){n.r(t),n.d(t,{TagControlRenderer:function(){return I},default:function(){return F}});var a=n(31635),i=n(96540),r=n(5917),o=n(27648),s=n(7309),l=n.n(s),d=n(64846),u=n.n(d),p=n(21283),c=n.n(p),h=n(83673),m=n.n(h),_=n(63375),g=n.n(_),v=n(40961),y=n(25627),f=n(66283),O=n(51545),F=function(e){function t(t){var n=e.call(this,t)||this;return n.input=i.createRef(),n.state={isOpened:!1,inputValue:"",isFocused:!1,selectedOptions:t.selectedOptions,cacheOptions:[]},n}return(0,a.__extends)(t,e),t.prototype.componentDidUpdate=function(e){var t=this.props;e.value!==t.value&&this.setState({inputValue:""})},t.prototype.doAction=function(e,t,n){var a,i,o=this.props,s=o.resetValue,l=o.onChange,d=o.formStore,u=o.store,p=o.name,c=null==e?void 0:e.actionType;if("clear"===c)null==l||l("");else if("reset"===c){var h=null!==(i=(0,r.dnO)(null!==(a=null==d?void 0:d.pristine)&&void 0!==a?a:null==u?void 0:u.pristine,p))&&void 0!==i?i:s;null==l||l(null!=h?h:"")}},t.prototype.dispatchEvent=function(e,t){return void 0===t&&(t={}),(0,a.__awaiter)(this,void 0,void 0,function(){var n,i,o,s;return(0,a.__generator)(this,function(l){switch(l.label){case 0:return n=this.props,i=n.dispatchEvent,o=n.options,[4,i(e,(0,r.RKM)(this.props,(0,a.__assign)({options:o,items:o},t)))];case 1:return[2,!!(null==(s=l.sent())?void 0:s.prevented)]}})})},t.prototype.normalizeInputValue=function(e){var t=this.props,n=t.enableBatchAdd,i=t.separator,r=t.valueField,o=t.labelField,s=t.delimiter,l=[];if(n&&i&&"string"==typeof i)l=e.split(i);else{var d=g()(m()(e.split(s||",")));l.push.apply(l,(0,a.__spreadArray)([],(0,a.__read)(d),!1))}return l.filter(Boolean).map(function(e){var t;return(t={})["".concat(r||"value")]=e,t["".concat(o||"label")]=e,t})},t.prototype.normalizeOptions=function(e){var t=this.props,n=t.joinValues,a=t.extractValue,i=t.delimiter,r=t.valueField;return n?e.map(function(e){return e[r||"value"]}).join(i||","):a?e.map(function(e){return e[r||"value"]}):e},t.prototype.normalizeMergedValue=function(e,t){void 0===t&&(t=!0);var n=this.props,a=n.selectedOptions,i=n.valueField,r=c()(a.concat(),this.normalizeInputValue(e),function(e,t){return e[i||"value"]===t[i||"value"]});return t?this.normalizeOptions(r):r},t.prototype.validateInputValue=function(e){var t=this.props,n=t.max,a=t.maxTagLength,i=(t.enableBatchAdd,t.separator,t.onInputValidateFailed),r=t.valueField,o=this.normalizeMergedValue(e,!1);if(null!=n&&u()(n)&&o.length>n)return null==i||i(o.map(function(e){return e[r||"value"]}),"max"),!1;var s=this.normalizeInputValue(e);return null==a||!u()(a)||!s.some(function(e){return e[r||"value"].length>a})||(null==i||i(s.map(function(e){return e[r||"value"]}),"maxLength"),!1)},t.prototype.getValue=function(e,t,n){void 0===e&&(e="normal"),void 0===t&&(t={});var a=this.props,i=a.joinValues,r=a.extractValue,o=a.delimiter,s=a.valueField,l=(n=n||this.props.selectedOptions).concat();return"push"===e?l.push(t):"pop"===e&&l.pop(),i?l.map(function(e){return e[s||"value"]}).join(o||","):r?l.map(function(e){return e[s||"value"]}):l},t.prototype.addItem=function(e){return(0,a.__awaiter)(this,void 0,void 0,function(){var t,n,i,r,o,s;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return this.isReachMax()?[2]:(t=this.props,n=t.selectedOptions,i=t.onChange,r=t.valueField,o=n.concat(),l()(o,function(t){return t[r||"value"]==e[r||"value"]})?[2]:(s=this.getValue("push",e),[4,this.dispatchEvent("change",{value:s,selectedItems:n.concat(e)})]));case 1:return a.sent()||i(s),[2]}})})},t.prototype.addItem2=function(e){var t=this.props,n=t.mobileUI,a=t.valueField,i=void 0===a?"value":a;if(n){var r=this.state.selectedOptions.concat(),o=r.findIndex(function(t){return t[i]===e[i]});~o?r.splice(o,1):this.isReachMaxFromState()||r.push(e),this.setState({selectedOptions:r})}},t.prototype.isExist=function(e){var t=this.props,n=t.options,a=t.valueField,i=void 0===a?"value":a,r=this.state.cacheOptions;return n.some(function(t){return t[i]===e})||r.some(function(t){return t[i]===e})},t.prototype.addSelection=function(){var e=this.state.inputValue,t=this.props.maxTagLength,n=this.state.selectedOptions.slice(),a=this.state.cacheOptions.slice();if(void 0!==t&&(e=(e=e.trim()).slice(0,t)),!this.isExist(e)&&e&&!this.isReachMaxFromState()){var i=this.normalizeInputValue(e);n.push(i[0]),a.push(i[0]),this.setState({inputValue:"",selectedOptions:n,cacheOptions:a})}},t.prototype.onConfirm=function(){return(0,a.__awaiter)(this,void 0,void 0,function(){var e,t,n;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return e=this.state.selectedOptions,t=this.props.onChange,n=this.getValue("normal",{},e),[4,this.dispatchEvent("change",{value:n,selectedItems:e})];case 1:return a.sent()||t(n),this.close(),[2]}})})},t.prototype.handleFocus=function(e){var t,n;return(0,a.__awaiter)(this,void 0,void 0,function(){var i;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return this.setState({isFocused:!0,isOpened:!0,selectedOptions:this.props.selectedOptions}),i=this.getValue("normal"),[4,this.dispatchEvent("focus",{value:i,selectedItems:this.props.selectedOptions})];case 1:return a.sent()||null===(n=(t=this.props).onFocus)||void 0===n||n.call(t,e),[2]}})})},t.prototype.handleBlur=function(e){var t,n;return(0,a.__awaiter)(this,void 0,void 0,function(){var i,r,o,s,l,d,u;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return i=this.props,r=i.selectedOptions,o=i.onChange,s=i.mobileUI,l=i.options,s&&l.length?[2]:(d=this.state.inputValue.trim(),this.validateInputValue(d)?(u=this.normalizeMergedValue(d),[4,this.dispatchEvent("blur",{value:u,selectedItems:r})]):(this.setState({isFocused:!1,isOpened:!1}),[2]));case 1:return a.sent()||null===(n=(t=this.props).onBlur)||void 0===n||n.call(t,e),this.setState({isFocused:!1,isOpened:!1,inputValue:""},d?function(){r.length!==u.length&&(null==o||o(u))}:void 0),[2]}})})},t.prototype.close=function(){this.setState({isOpened:!1})},t.prototype.handleInputChange=function(e){this.setState({inputValue:e})},t.prototype.handleChange=function(e){return(0,a.__awaiter)(this,void 0,void 0,function(){var t,n,i,r,o,s,l;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return t=this.props,n=t.joinValues,i=t.extractValue,r=t.delimiter,o=t.valueField,s=t.onChange,l=Array.isArray(e)?e.concat():[],(n||i)&&(l=e.map(function(e){return e[o||"value"]})),n&&(l=l.join(r||",")),[4,this.dispatchEvent("change",{value:l,selectedItems:e})];case 1:return a.sent()||s(l),[2]}})})},t.prototype.renderItem=function(e){var t=this.props.labelField;return"".concat(e[t||"label"])},t.prototype.handleKeyDown=function(e){return(0,a.__awaiter)(this,void 0,void 0,function(){var t,n,i,r,o,s,l,d;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return t=this.props,n=t.selectedOptions,i=t.onChange,r=t.delimiter,t.labelField,t.valueField,o=this.state.inputValue.trim(),s=n.concat(this.normalizeMergedValue(o,!1)),!n.length||o||"Backspace"!=e.key?[3,2]:(l=this.getValue("pop"),[4,this.dispatchEvent("change",{value:l,selectedItems:s})]);case 1:return(d=a.sent())||i(l),[3,5];case 2:return!o||"Enter"!==e.key&&e.key!==r?[3,4]:(e.preventDefault(),e.stopPropagation(),l=this.normalizeMergedValue(o),[4,this.dispatchEvent("change",{value:l,selectedItems:s})]);case 3:return d=a.sent(),this.validateInputValue(o)?(d||n.length===l.length||i(l),this.setState({inputValue:""}),[3,5]):(this.setState({isFocused:!1,isOpened:!1}),[2]);case 4:o||"Enter"!==e.key||this.handleBlur(e),a.label=5;case 5:return[2]}})})},t.prototype.handleOptionChange=function(e){this.props.mobileUI?this.addItem2(e):!this.isReachMax()&&e&&this.addItem(e)},t.prototype.getTarget=function(){return this.input.current},t.prototype.getParent=function(){return this.input.current&&(0,v.findDOMNode)(this.input.current).parentElement},t.prototype.reload=function(){var e=this.props.reloadOptions;null==e||e()},t.prototype.isReachMax=function(){var e=this.props,t=e.max,n=e.selectedOptions;return null!=t&&u()(t)&&n.length>=t},t.prototype.isReachMaxFromState=function(){var e=this.state.selectedOptions,t=this.props.max;return null!=t&&u()(t)&&e.length>=t},t.prototype.render=function(){var e=this,t=this.props,n=t.className,s=(t.style,t.classnames),l=t.disabled,d=t.placeholder,u=t.name,p=t.clearable,c=t.selectedOptions,h=t.loading,m=t.popOverContainer,_=t.dropdown,g=t.options,v=t.optionsTip,f=t.maxTagCount,F=t.overflowTagPopover,I=t.translate,b=t.loadingConfig,C=t.valueField,V=t.env,x=t.mobileUI,E=t.labelField,w=t.testIdBuilder,S=this.state.inputValue,T=Array.isArray(g)?(0,r.hVz)(g,function(e,t,n,a){return void 0!==e[C||"value"]&&(x||!~c.indexOf(e))&&((0,O.matchSorter)([e].concat(a),S,{keys:[E||"label",C||"value"],threshold:O.matchSorter.rankings.CONTAINS}).length||Array.isArray(e.children)&&!!e.children.length)},0,!0):[],M=this.isReachMax();return i.createElement(o.Ay,{selectedItem:c,isOpen:x?this.state.isOpened:this.state.isFocused,inputValue:this.state.inputValue,onChange:this.handleOptionChange,itemToString:this.renderItem},function(t){var o=t.isOpen,O=t.highlightedIndex,E=t.getItemProps,S=t.getInputProps;return i.createElement("div",{className:s(n,"TagControl")},i.createElement(y.dM,(0,a.__assign)({},S({name:u,ref:e.input,placeholder:I(null!=d?d:"Tag.placeholder"),value:e.state.inputValue,onKeyDown:e.handleKeyDown,onFocus:x?void 0:e.handleFocus,onBlur:e.handleBlur,disabled:l}),{onResultClick:x?e.handleFocus:void 0,inputPlaceholder:"",onChange:e.handleInputChange,className:s("TagControl-input"),result:c,onResultChange:e.handleChange,itemRender:e.renderItem,clearable:p,maxTagCount:f,overflowTagPopover:F,popOverContainer:m||V.getModalContainer,allowInput:!x||x&&!(null==g?void 0:g.length),mobileUI:x,testIdBuilder:null==w?void 0:w.getChild("resule-box")}),h?i.createElement(y.y$,{loadingConfig:b,size:"sm"}):void 0),!1!==_?x?i.createElement(y.HH,{className:s("Tag-popup"),container:x?null==V?void 0:V.getModalContainer:m||V.getModalContainer,isShow:o&&!!T.length,showConfirm:!0,onConfirm:e.onConfirm,onHide:e.close},i.createElement("div",null,i.createElement(y.Kv,{selectedOptions:c,mobileUI:x,options:T.concat(e.state.cacheOptions),itemRender:e.renderItem,highlightIndex:O,getItemProps:function(t){var n=t.item,i=t.index;return(0,a.__assign)({},E({index:i,item:n,className:s("ListMenu-item",{"is-active":~(e.state.selectedOptions.map(function(e){return e[C]})||[]).indexOf(n[C])})}))}}),x&&!e.isReachMaxFromState()?i.createElement("div",{className:s("ListMenu-add-wrap")},i.createElement(y.dM,{placeholder:I("placeholder.enter")+"...",allowInput:!0,value:e.state.inputValue,mobileUI:x,clearable:!0,maxTagCount:f,onChange:function(t){e.setState({inputValue:t})},onBlur:e.addSelection})):null)):i.createElement(r.hJs,{container:m||e.getParent,target:e.getTarget,placement:"auto",show:o&&!!T.length},i.createElement(r.Kx3,{overlay:!0,className:s("TagControl-popover"),onHide:e.close},i.createElement(y.Kv,{options:T,itemRender:e.renderItem,highlightIndex:O,testIdBuilder:null==w?void 0:w.getChild("options"),getItemProps:function(e){var t=e.item,n=e.index;return(0,a.__assign)({},E({index:n,item:t,disabled:M||t.disabled,className:s("ListMenu-item",{"is-disabled":M})}))}}))):i.createElement("div",{className:s("TagControl-sug")},v?i.createElement("div",{className:s("TagControl-sugTip")},I(v)):null,g.map(function(t,n){return i.createElement("div",{className:s("TagControl-sugItem",{"is-disabled":t.disabled||l||M}),key:n,onClick:e.addItem.bind(e,t)},t.label)})))})},t.defaultProps={resetValue:"",labelField:"label",valueField:"value",multiple:!0,placeholder:"Tag.placeholder",optionsTip:"Tag.tip",separator:"-"},(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[String,Object]),(0,a.__metadata)("design:returntype",Promise)],t.prototype,"dispatchEvent",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[String,Object,Array]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"getValue",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"addSelection",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[]),(0,a.__metadata)("design:returntype",Promise)],t.prototype,"onConfirm",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",Promise)],t.prototype,"handleFocus",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",Promise)],t.prototype,"handleBlur",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"close",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[String]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"handleInputChange",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Array]),(0,a.__metadata)("design:returntype",Promise)],t.prototype,"handleChange",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",Object)],t.prototype,"renderItem",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",Promise)],t.prototype,"handleKeyDown",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"handleOptionChange",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"getTarget",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"getParent",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"isReachMax",null),(0,a.__decorate)([r.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"isReachMaxFromState",null),(0,a.__decorate)([(0,f.E)(),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"render",null),t}(i.PureComponent),I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,a.__extends)(t,e),(0,a.__decorate)([(0,r.QqA)({type:"input-tag"})],t)}(F)}}]);