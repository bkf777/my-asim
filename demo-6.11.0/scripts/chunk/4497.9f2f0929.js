"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[4497],{44497:function(e,t,a){a.r(t),a.d(t,{PageRenderer:function(){return p},PageRendererBase:function(){return d},default:function(){return l}});var n=a(31635),o=a(96540),i=a(5917),s=a(25627),r=a(50346),l=function(e){function t(t){var a=e.call(this,t)||this;return(0,i.v6M)(a,["handleAction","handleChange","handleBulkChange","handleQuery","handleDialogConfirm","handleDialogClose","handleDrawerConfirm","handleDrawerClose","handleClick","reload","silentReload","initInterval"]),a.style=document.createElement("style"),a.style.setAttribute("data-page",""),document.getElementsByTagName("head")[0].appendChild(a.style),a.updateStyle(),a.varStyle=document.createElement("style"),a.varStyle.setAttribute("data-vars",""),document.getElementsByTagName("head")[0].appendChild(a.varStyle),a.updateVarStyle(),a}return(0,n.__extends)(t,e),t.prototype.updateStyle=function(){this.props.css||this.props.mobileCSS?this.style.innerHTML="\n      ".concat(this.buildCSS(this.props.css),"\n\n      @media (max-width: 768px) {\n        ").concat(this.buildCSS(this.props.mobileCSS),"\n      }\n      "):this.style.innerHTML=""},t.prototype.buildCSS=function(e){if(!e)return"";var t="";for(var a in e){var n=e[a],o="";for(var i in n){var s="",r=n[i];if("string"==typeof r)o+="  ".concat(i,": ").concat(r,";\n");else{for(var l in r)s+=" ".concat(l,":").concat(r[l],";");o+="  ".concat(i," {").concat(s,"}\n")}}t+="\n      ".concat(a," {\n        ").concat(o,"\n      }\n      ")}return t},t.prototype.updateVarStyle=function(){var e=this.props.cssVars,t="";if(e){for(var a in e)if(a.startsWith("--")){if(-1!==a.indexOf(":"))continue;var n=e[a];if("string"==typeof n&&(-1!==n.indexOf("expression(")||-1!==n.indexOf(";")))continue;t+="".concat(a,": ").concat(n,"; \n")}this.varStyle.innerHTML="\n      :root {\n        ".concat(t,"\n      }\n      ")}},t.prototype.componentDidMount=function(){return(0,n.__awaiter)(this,void 0,void 0,function(){var e,t,a,o,s,l,d,p,c,h;return(0,n.__generator)(this,function(n){switch(n.label){case 0:return e=this.props,t=e.initApi,a=e.initFetch,o=e.initFetchOn,s=e.store,l=e.messages,d=e.data,p=e.dispatchEvent,c=e.env,this.mounted=!0,[4,p("init",d,this)];case 1:return h=n.sent(),(null==c?void 0:c.tracker)&&c.tracker({eventType:"pageLoaded"},this.props),(null==h?void 0:h.prevented)||!(0,r.isAlive)(s)||(0,i.Amo)(t,s.data,a,o)&&s.fetchInitData(t,s.data,{successMessage:l&&l.fetchSuccess,errorMessage:l&&l.fetchFailed}).then(this.initInterval),[2]}})})},t.prototype.componentDidUpdate=function(e){var t=this.props,a=t.store,n=t.initApi;if(t.initFetchOn&&t.initFetch&&!e.initFetch||!1!==t.initFetch&&(0,i.B92)(e.initApi,n,e.data,t.data)){var o=t.messages;(0,i.Amo)(n,a.data)&&a.fetchData(n,a.data,{successMessage:o&&o.fetchSuccess,errorMessage:o&&o.fetchFailed}).then(this.initInterval)}JSON.stringify(t.css)===JSON.stringify(e.css)&&JSON.stringify(t.mobileCSS)===JSON.stringify(e.mobileCSS)||this.updateStyle(),JSON.stringify(t.cssVars)!==JSON.stringify(e.cssVars)&&this.updateVarStyle(),(0,i.JQ)(e.defaultData,t.defaultData)&&a.reInitData(t.defaultData)},t.prototype.componentWillUnmount=function(){var e,t;this.mounted=!1,clearTimeout(this.timer),this.style&&(null===(e=this.style.parentNode)||void 0===e||e.removeChild(this.style)),this.varStyle&&(null===(t=this.varStyle.parentNode)||void 0===t||t.removeChild(this.varStyle))},t.prototype.reloadTarget=function(e,t){},t.prototype.handleAction=function(e,t,a,o,s){var r=this;void 0===o&&(o=!1);var l=this.props,d=l.env,p=l.store,c=l.messages,h=l.onAction;if("dialog"===t.actionType)return p.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(e){p.openDialog(a,void 0,function(a,n){var o;null===(o=t.callback)||void 0===o||o.call(t,a,n),e({confirmed:a,value:n})},s||r.context)});if("drawer"===t.actionType)return p.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(e){p.openDrawer(a,void 0,function(a,n){var o;null===(o=t.callback)||void 0===o||o.call(t,a,n),e({confirmed:a,value:n})},s)});if("ajax"===t.actionType){if(p.setCurrentAction(t,this.props.resolveDefinitions),!(0,i.Amo)(t.api,a))return;return p.saveRemote(t.api,a,{successMessage:t.messages&&t.messages.success||c&&c.saveSuccess,errorMessage:t.messages&&t.messages.failed||c&&c.saveSuccess}).then(function(){return(0,n.__awaiter)(r,void 0,void 0,function(){var e;return(0,n.__generator)(this,function(a){switch(a.label){case 0:return t.feedback&&(0,i.zNq)(t.feedback,p.data)?[4,this.openFeedback(t.feedback,p.data)]:[3,2];case 1:a.sent(),a.label=2;case 2:return(e=t.redirect&&(0,i.pbD)(t.redirect,p.data))&&d.jumpTo(e,t,p.data),t.reload&&this.reloadTarget((0,i.Wvn)(t.reload,p.data),p.data),[2]}})})}).catch(function(e){if(o||t.countDown)throw e})}return h(e,t,a,o,s||this.context)},t.prototype.handleQuery=function(e){return this.props.initApi?!((null==e?void 0:e.hasOwnProperty("orderBy"))&&!(0,i.B92)(this.props.initApi,this.props.initApi,this.props.store.data,(0,i.ed2)(this.props.store.data,e)))&&void this.receive(e):!!this.props.onQuery&&this.props.onQuery(e)},t.prototype.handleDialogConfirm=function(e,t){for(var a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];var i=this.props.store;t.mergeData&&1===e.length&&e[0]&&i.updateData(e[0]);var s=i.action.dialog;s&&s.onConfirm&&!1===s.onConfirm.apply(s,(0,n.__spreadArray)([e,t],(0,n.__read)(a),!1))||i.closeDialog(!0,e)},t.prototype.handleDialogClose=function(e){void 0===e&&(e=!1),this.props.store.closeDialog(e)},t.prototype.handleDrawerConfirm=function(e,t){for(var a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];var i=this.props.store;t.mergeData&&1===e.length&&e[0]&&i.updateData(e[0]);var s=i.action.dialog;s&&s.onConfirm&&!1===s.onConfirm.apply(s,(0,n.__spreadArray)([e,t],(0,n.__read)(a),!1))||i.closeDrawer(!0,e)},t.prototype.handleDrawerClose=function(){this.props.store.closeDrawer(!1)},t.prototype.handleClick=function(e){var t,a=e.target,n=this.props.env,o="A"===a.tagName&&a.hasAttribute("data-link")?a.getAttribute("data-link"):null===(t=a.closest("a[data-link]"))||void 0===t?void 0:t.getAttribute("data-link");n&&o&&(n.jumpTo(o,void 0,this.props.data),e.preventDefault())},t.prototype.handleResizeMouseDown=function(e){3==e.nativeEvent.which||(this.codeWrap=e.currentTarget.parentElement,document.addEventListener("mousemove",this.handleResizeMouseMove),document.addEventListener("mouseup",this.handleResizeMouseUp),this.startX=e.clientX,this.startWidth=this.codeWrap.offsetWidth)},t.prototype.handleResizeMouseMove=function(e){var t=this.props,a=t.asideMinWidth,n=void 0===a?160:a,o=t.asideMaxWidth,i=void 0===o?350:o,s=t.asidePosition,r=e.clientX-this.startX,l="right"===s?this.startWidth-r:this.startWidth+r,d=Math.min(Math.max(l,n),i);this.codeWrap.style.cssText+="width: ".concat(d,"px")},t.prototype.handleResizeMouseUp=function(){document.removeEventListener("mousemove",this.handleResizeMouseMove),document.removeEventListener("mouseup",this.handleResizeMouseUp)},t.prototype.openFeedback=function(e,t){var a=this;return new Promise(function(n){var o=a.props.store;o.setCurrentAction({type:"button",actionType:"dialog",dialog:e},a.props.resolveDefinitions),o.openDialog(t,void 0,function(e){n(e)},a.context)})},t.prototype.reload=function(e,t,a,o,s){return(0,n.__awaiter)(this,void 0,void 0,function(){var e,a,r,l;return(0,n.__generator)(this,function(n){switch(n.label){case 0:return t?[2,this.receive(t,void 0,s)]:(e=this.props,a=e.store,r=e.initApi,clearTimeout(this.timer),(0,i.Amo)(r,a.data)?[4,a.fetchData(r,a.data,{silent:o})]:[3,2]);case 1:l=n.sent(),this.initInterval(l),n.label=2;case 2:return[2,a.data]}})})},t.prototype.receive=function(e,t,a){this.props.store.updateData(e,void 0,a),this.reload()},t.prototype.silentReload=function(e,t){this.reload(t,void 0,void 0,!0)},t.prototype.initInterval=function(e){var t,a=this.props,o=a.interval,s=a.silentPolling,r=a.stopAutoRefreshWhen,l=a.data,d=a.dispatchEvent,p=a.store;return d("inited",(0,i.ed2)(l,(0,n.__assign)((0,n.__assign)({},null==e?void 0:e.data),{responseData:(null==e?void 0:e.ok)?null!==(t=null==e?void 0:e.data)&&void 0!==t?t:{}:e,responseStatus:void 0===(null==e?void 0:e.status)?(null==p?void 0:p.error)?1:0:null==e?void 0:e.status,responseMsg:(null==e?void 0:e.msg)||(null==p?void 0:p.msg)}))),(null==e?void 0:e.ok)&&o&&this.mounted&&(!r||!(0,i.pgu)(r,l))&&(this.timer=setTimeout(s?this.silentReload:this.reload,Math.max(o,1e3))),e},t.prototype.handleRefresh=function(){return(0,n.__awaiter)(this,void 0,void 0,function(){var e,t,a,o;return(0,n.__generator)(this,function(n){switch(n.label){case 0:return e=this.props,t=e.dispatchEvent,a=e.data,[4,t("pullRefresh",a)];case 1:return(null==(o=n.sent())?void 0:o.prevented)||this.reload(),[2]}})})},t.prototype.handleChange=function(e,t,a,n){var o=this.props,i=o.store,s=o.onChange;"string"==typeof t&&t&&i.changeValue(t,e,n),null==s||s.apply(null,arguments)},t.prototype.handleBulkChange=function(e){var t,a;null===(a=null===(t=this.props.store)||void 0===t?void 0:t.updateData)||void 0===a||a.call(t,e)},t.prototype.renderHeader=function(){var e,t,a=this.props,s=a.title,r=a.subTitle,l=a.remark,d=a.remarkPlacement,p=a.headerClassName,c=a.toolbarClassName,h=a.toolbar,u=a.render,m=a.store,g=a.initApi,v=a.popOverContainer,y=a.env,f=a.classnames,C=a.regions,_=(a.translate,a.id),b=a.themeCss,D={onAction:this.handleAction,onQuery:g?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:m.loading};return(Array.isArray(C)?~C.indexOf("header"):s||r)&&(e=o.createElement("div",{className:f("Page-header",p,(0,i.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"headerControlClassName",id:_,themeCss:b})))},s?o.createElement("h2",{className:f("Page-title",(0,i.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"titleControlClassName",id:_,themeCss:b})))},u("title",s,D),l?u("remark",{type:"remark",tooltip:l,placement:d||"bottom",container:v||y.getModalContainer}):null):null,r&&o.createElement("small",{className:f("Page-subTitle")},u("subTitle",r,D)))),(Array.isArray(C)?~C.indexOf("toolbar"):h)&&(t=o.createElement("div",{className:f("Page-toolbar",c,(0,i.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"toolbarControlClassName",id:_,themeCss:b})))},u("toolbar",h||"",D))),e&&t?o.createElement("div",{className:f("Page-headerRow")},e,t):e||t},t.prototype.renderContent=function(e){var t=this.props,a=t.store,r=t.body,l=t.bodyClassName,d=t.render,p=t.classnames,c=t.showErrorMsg,h=t.regions,u=(t.translate,t.loadingConfig),m=(t.initApi,t.id),g=t.env,v=t.themeCss;return o.createElement("div",{className:p("Page-content")},o.createElement("div",{className:p("Page-main")},this.renderHeader(),o.createElement("div",{className:p("Page-body",l,(0,i.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"bodyControlClassName",id:m,themeCss:v}))),role:"page-body"},o.createElement(s.y$,{size:"lg",overlay:!0,key:"info",show:a.loading,loadingConfig:u}),!g.forceSilenceInsideError&&a.error&&!1!==c?o.createElement(s.pM,{level:"danger",showCloseButton:!0,onClose:a.clearMessage},a.msg):null,(Array.isArray(h)?~h.indexOf("body"):r)?d("body",r||"",e):null)))},t.prototype.render=function(){var e=this.props,t=e.className,a=e.store,r=(e.body,e.bodyClassName,e.render),l=e.aside,d=e.asideClassName,p=e.classnames,c=(e.showErrorMsg,e.initApi),h=e.regions,u=e.style,m=e.data,g=e.asideResizor,v=e.asideSticky,y=e.pullRefresh,f=e.mobileUI,C=e.translate,_=(e.loadingConfig,e.id),b=e.wrapperCustomStyle,D=e.env,N=e.themeCss,w=e.asidePosition,A={onAction:this.handleAction,onQuery:c?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:a.loading},S=Array.isArray(h)?~h.indexOf("aside"):l&&(!Array.isArray(l)||l.length),k=(0,i.K8U)(u,m),M=this.renderContent(A);return o.createElement("div",{className:p("Page",S?"Page--withSidebar":"",S&&v?"Page--asideSticky":"",S&&w?"Page--".concat(w,"Aside"):"",t,(0,i.NH8)((0,n.__assign)({name:"baseControlClassName",id:_,themeCss:N},this.props)),(0,i.NH8)((0,n.__assign)({name:"wrapperCustomStyle",id:_,themeCss:b},this.props))),onClick:this.handleClick,style:k},S?o.createElement("div",{className:p("Page-aside",g?"relative":"Page-aside--withWidth",d,(0,i.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"asideControlClassName",id:_,themeCss:N})))},r("aside",l||"",(0,n.__assign)((0,n.__assign)({},A),"string"==typeof l?{inline:!1,className:"Page-asideTplWrapper"}:null)),g?o.createElement("div",{onMouseDown:this.handleResizeMouseDown,className:p("Page-asideResizor")}):null):null,f&&y&&!y.disabled?o.createElement(s.j5,(0,n.__assign)({},y,{translate:C,onRefresh:this.handleRefresh}),M):M,r("dialog",(0,n.__assign)((0,n.__assign)({},a.action&&a.action.dialog),{type:"dialog"}),{key:"dialog",data:a.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:a.dialogOpen,onAction:this.handleAction,onQuery:c?this.handleQuery:void 0}),r("drawer",(0,n.__assign)((0,n.__assign)({},a.action&&a.action.drawer),{type:"drawer"}),{key:"drawer",data:a.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:a.drawerOpen,onAction:this.handleAction,onQuery:c?this.handleQuery:void 0}),o.createElement(i.z4D,(0,n.__assign)({},this.props,{config:{wrapperCustomStyle:b,id:_,themeCss:N,classNames:[{key:"baseControlClassName",weights:{default:{important:!0},hover:{important:!0},active:{important:!0}}},{key:"bodyControlClassName"},{key:"headerControlClassName"},{key:"titleControlClassName"},{key:"toolbarControlClassName"},{key:"asideControlClassName"}]},env:D})))},t.defaultProps={asideClassName:"",bodyClassName:"",headerClassName:"",initFetch:!0,toolbarClassName:"",messages:{},asideSticky:!0,asidePosition:"left",pullRefresh:{disabled:!0}},t.propsList=["title","subTitle","initApi","initFetchOn","initFetch","headerClassName","bodyClassName","asideClassName","toolbarClassName","toolbar","body","aside","messages","style","showErrorMsg"],(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"handleResizeMouseDown",null),(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[MouseEvent]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"handleResizeMouseMove",null),(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"handleResizeMouseUp",null),(0,n.__decorate)([i.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",Promise)],t.prototype,"handleRefresh",null),t}(o.Component),d=function(e){function t(t,a){var n=e.call(this,t)||this;return a.registerComponent(n),n}return(0,n.__extends)(t,e),t.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this)},t.prototype.reloadTarget=function(e,t){this.context.reload(e,t)},t.prototype.handleAction=function(t,a,o,i,s){return void 0===i&&(i=!1),(0,n.__awaiter)(this,void 0,void 0,function(){var r,l;return(0,n.__generator)(this,function(d){switch(d.label){case 0:return r=s||this.context,"reload"!==a.actionType?[3,1]:(a.target&&r.reload(a.target,o),[3,4]);case 1:return a.target?(a.target.split(",").forEach(function(e){var t=r.getComponentByName(e);t&&t.doAction&&t.doAction((0,n.__assign)((0,n.__assign)({},a),{target:void 0}),o)}),[3,4]):[3,2];case 2:return[4,e.prototype.handleAction.call(this,t,a,o,i,s)];case 3:return l=d.sent(),a.reload&&~["url","link","jump"].indexOf(a.actionType)&&r.reload(a.reload,o),[2,l];case 4:return[2]}})})},t.prototype.handleDialogConfirm=function(t,a){for(var o,i,s=[],r=2;r<arguments.length;r++)s[r-2]=arguments[r];var l=this.props.store,d=l.action,p=null!==(o=a.reload)&&void 0!==o?o:d.reload,c=l.getDialogScoped()||this.context;e.prototype.handleDialogConfirm.apply(this,(0,n.__spreadArray)([t,a],(0,n.__read)(s),!1)),p?c.reload(p,l.data):(null==c?void 0:c.component)!==this&&(null===(i=c.component)||void 0===i?void 0:i.reload)?c.component.reload():this.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},t.prototype.handleDrawerConfirm=function(t,a){for(var n,o=this,i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var r=this.props.store,l=r.action,d=null!==(n=a.reload)&&void 0!==n?n:l.reload,p=r.getDrawerScoped()||this.context;e.prototype.handleDrawerConfirm.call(this,t,a),setTimeout(function(){var e;d?p.reload(d,r.data):p.component!==o&&(null===(e=null==p?void 0:p.component)||void 0===e?void 0:e.reload)?p.component.reload():o.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},300)},t.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},t.prototype.getData=function(){return this.props.store.data},t.contextType=i.MzX,t}(l),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),(0,n.__decorate)([(0,i.A49)({type:"page",storeType:i.DtI.name,isolateScope:!0})],t)}(d)}}]);