"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[4455],{94455:function(e,t,n){n.r(t),n.d(t,{TableControlRenderer:function(){return _},default:function(){return v}});var i=n(31635),a=n(96540),s=n(5917),r=n(25627),o=n(90179),l=n.n(o),d=n(7309),u=n.n(d),c=n(38221),h=n.n(c),p=n(95093),m=n.n(p),f="__isPlaceholder",v=function(e){function t(t){var n=e.call(this,t)||this;n.entityId=1,n.subForms={},n.subFormItems={},n.rowPrinstine=[],n.editting={},n.toDispose=[],n.lazyEmitValue=h()(n.emitValue.bind(n),50,{trailing:!0,leading:!1}),n.emittedValue=null;var a=t.addHook,r=Array.isArray(t.value)?t.value.concat():[];return n.state=(0,i.__assign)({columns:n.buildColumns(t),editIndex:"",items:r},n.transformState(r)),n.entries=new s.NH2,n.buildItemProps=n.buildItemProps.bind(n),n.confirmEdit=n.confirmEdit.bind(n),n.cancelEdit=n.cancelEdit.bind(n),n.handleSaveTableOrder=n.handleSaveTableOrder.bind(n),n.handleTableSave=n.handleTableSave.bind(n),n.handleRadioChange=n.handleRadioChange.bind(n),n.getEntryId=n.getEntryId.bind(n),n.subFormRef=n.subFormRef.bind(n),n.subFormItemRef=n.subFormItemRef.bind(n),n.handlePageChange=n.handlePageChange.bind(n),n.handleTableQuery=n.handleTableQuery.bind(n),n.emitValue=n.emitValue.bind(n),n.tableRef=n.tableRef.bind(n),n.flush=n.flush.bind(n),n.filterItemIndex=n.filterItemIndex.bind(n),a&&n.toDispose.push(a(n.flush,"flush")),n}return(0,i.__extends)(t,e),t.prototype.componentDidUpdate=function(e,t){var n=this.props,a=null;if(e.disabled!==n.disabled||e.static!==n.static||n.$schema.disabled!==e.$schema.disabled||n.$schema.static!==e.$schema.static){var s=this.state.items.filter(function(e){return!e.hasOwnProperty(f)});a=(0,i.__assign)((0,i.__assign)((0,i.__assign)((0,i.__assign)({},a),{items:s}),this.transformState(s)),{editIndex:"",columns:this.buildColumns(n)})}n.columns!==e.columns&&(a=(0,i.__assign)((0,i.__assign)({},a),{columns:this.buildColumns(n)})),n.value!==e.value&&n.value!==this.emittedValue&&(s=Array.isArray(n.value)?n.value.concat():[],a=(0,i.__assign)((0,i.__assign)((0,i.__assign)((0,i.__assign)({},a),{items:s}),this.transformState(s)),{editIndex:""})),a&&this.setState(a)},t.prototype.componentWillUnmount=function(){this.entries.dispose(),this.lazyEmitValue.cancel(),this.toDispose.forEach(function(e){return e()}),this.toDispose=[]},t.prototype.transformState=function(e,t,n){var a=this.props,r=a.perPage,o=a.matchFunc,l=(0,i.__assign)((0,i.__assign)({},this.state),t),d=l.query,u=l.page,c=null!=d?d:{},h=c.orderBy,p=c.orderDir,m=(0,i.__rest)(c,["orderBy","orderDir"]);Object.keys(m).length&&(e=(0,s.W5d)(e,{query:m,columns:this.state.columns,matchFunc:"string"==typeof o&&o?(0,s.sce)(o,"items","itemsRaw","options"):"function"==typeof o?o:void 0})),h&&(e=(0,s.ehs)(e.concat(),h,"string"==typeof p&&/desc/i.test(p)?-1:1));var f=e.length;if(u=Math.min(null!=u?u:1,"number"==typeof r?Math.max(1,Math.ceil(f/r)):1),n){var v=e.indexOf(n);~v&&(u=Math.ceil((v+1)/r))}return"number"==typeof r&&r&&e.length>r&&(e=e.slice((u-1)*r,u*r)),{filteredItems:e,page:u,total:f}},t.prototype.flush=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,t,n=this;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return e=[],Object.keys(this.subForms).forEach(function(t){return n.subForms[t]&&e.push(n.subForms[t])}),[4,Promise.all(e.map(function(e){return e.flush()}))];case 1:return i.sent(),t=[],Object.keys(this.subFormItems).forEach(function(e){return n.subFormItems[e]&&t.push(n.subFormItems[e])}),[4,Promise.all(t.map(function(e){var t,n;return null===(n=(t=e.props).onFlushChange)||void 0===n?void 0:n.call(t)}))];case 2:return i.sent(),[4,this.lazyEmitValue.flush()];case 3:return i.sent(),[2]}})})},t.prototype.resolveVariableProps=function(e,t){var n={minLength:0,maxLength:1/0},i=e[t];if(!i)return n[t];if("string"==typeof i)if((0,s.joH)(i)){var a=(0,s.GvO)(i,e.data,"| raw");i="number"==typeof a&&a>=0?a:n[t]}else{var r=parseInt(i,10);i=isNaN(r)?n[t]:r}return i},t.prototype.subFormRef=function(e,t,n){this.subForms["".concat(t,"-").concat(n)]=e},t.prototype.subFormItemRef=function(e,t,n){this.subFormItems["".concat(t,"-").concat(n)]=e},t.prototype.validate=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,t,n,a,r,o,l,d,u,c,h,p=this;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return e=this.props,t=e.value,n=e.translate,a=e.columns,r=this.resolveVariableProps(this.props,"minLength"),o=this.resolveVariableProps(this.props,"maxLength"),this.state.editIndex?[2,n("Table.editing")]:r&&(!Array.isArray(t)||t.length<r)?[2,n("Combo.minLength",{minLength:r})]:[3,1];case 1:return o&&Array.isArray(t)&&t.length>o?[2,n("Combo.maxLength",{maxLength:o})]:[3,2];case 2:return l=[],Object.keys(this.subForms).forEach(function(e){return p.subForms[e]&&l.push(p.subForms[e])}),l.length?[4,Promise.all(l.map(function(e){return e.validate()}))]:[3,4];case 3:if(d=i.sent(),u=~d.indexOf(!1)?n("Form.validateFailed"):"",c="",!u&&Array.isArray(a)&&Array.isArray(t)&&a.some(function(e){if(e.unique&&e.name){var n=[];return t.some(function(t){var i=(0,s.dnO)(t,e.name);return~n.indexOf(i)?(c="".concat(e.label||e.name),!0):(n.push(i),!1)})}return!1})&&(u=n("InputTable.uniqueError",{label:c})),u)return[2,u];i.label=4;case 4:return h=[],Object.keys(this.subFormItems).forEach(function(e){return p.subFormItems[e]&&h.push(p.subFormItems[e])}),[4,Promise.all(h.map(function(e){return e.props.onValidate()}))];case 5:return[2,~i.sent().indexOf(!1)?n("Form.validateFailed"):""]}})})},t.prototype.emitValue=function(e){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,n,a;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return t=null!=e?e:this.state.items.filter(function(e){return!e.hasOwnProperty(f)}),n=this.props.onChange,[4,this.dispatchEvent("change")];case 1:return(a=i.sent())||(this.emittedValue=t,null==n||n(t)),[2,a]}})})},t.prototype.doAction=function(e,t){for(var n,a,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return(0,i.__awaiter)(this,void 0,void 0,function(){var o,l,d,c,h,p,m,v,_,b,g,y,I,w,x,C,E,A=this;return(0,i.__generator)(this,function(P){switch(P.label){case 0:return o=this.props,l=o.onAction,d=o.valueField,c=o.env,h=o.needConfirm,p=o.addable,m=o.addApi,v=o.translate,_=o.onChange,"add"!==(b=e.actionType)?[3,6]:!1===p?[2]:(g=this.state.items.concat(),m||e.payload?(y=null,(0,s.Amo)(m,t)?[4,c.fetcher(m,t)]:[3,2]):[3,4]);case 1:return(I=P.sent())&&!I.ok?(!(null==m?void 0:m.silent)&&c.notify("error",null!==(a=null===(n=null==m?void 0:m.messages)||void 0===n?void 0:n.failed)&&void 0!==a?a:I.msg||v("fetchFailed")),[2]):(I&&I.ok&&(y=I.data),[3,3]);case 2:y=(0,s.nd1)(e.payload,t),P.label=3;case 3:return(y=Array.isArray(y)?y:[y]).forEach(function(e){d&&u()(g,function(t){return t[d]==e[d]})||(g.push(e),!1!==h&&Reflect.set(e,f,!0))}),this.setState((0,i.__assign)({items:g},this.transformState(g)),function(){1===y.length&&!1!==h?A.startEdit("".concat(g.length-1),!0):null==_||_(g)}),[2];case 4:return[2,this.addItem("".concat(g.length-1),!1)];case 5:return[3,7];case 6:if("remove"===b||"delete"===b)return d?e.payload?(w=this.state.items.concat(),x=(0,s.nd1)(e.payload,t),(x=Array.isArray(x)?x:[x]).forEach(function(e){var t=(0,s.iXH)(w,function(t){return t[d]==e[d]});(null==t?void 0:t.length)&&(w=(0,s.Z6D)(w,t,1))}),this.setState((0,i.__assign)({items:w},this.transformState(w)),function(){null==_||_(w)}),[2]):[2,c.alert(v("Table.playload"))]:[2,c.alert(v("Table.valueField"))];"initDrag"===b?(C=this.table).doAction.apply(C,(0,i.__spreadArray)([e,t],(0,i.__read)(r),!1)):"cancelDrag"===b&&(E=this.table).doAction.apply(E,(0,i.__spreadArray)([e,t],(0,i.__read)(r),!1)),P.label=7;case 7:return[2,l&&l.apply(void 0,(0,i.__spreadArray)([e,t],(0,i.__read)(r),!1))]}})})},t.prototype.copyItem=function(e){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,n,a,r,o,l,d,u,c,h,p,m,v,_,b,g,y=this;return(0,i.__generator)(this,function(I){return t=this.props,n=t.needConfirm,a=t.data,r=t.copyData,o=void 0===r?{"&":"$$"}:r,l=this.state.items.concat(),d=e.split(".").map(function(e){return parseInt(e,10)}),(u=d.concat())[u.length-1]+=1,c=l,h=(0,s.Jvj)(l,d),p=(0,s.nd1)(o,(0,s.ed2)(a,h)),l=!1===n?(0,s.Z6D)(l,u,0,p):(0,s.Z6D)(l,u,0,(0,i.__assign)((0,i.__assign)({},p),((g={})[f]=!0,g))),this.reUseRowId(l,c,u),m=l[u[0]],(v=(0,i.__assign)((0,i.__assign)({},this.transformState(l)),{items:l})).filteredItems.includes(m)||(_=l[d[0]],b=v.filteredItems.findIndex(function(e){return e===_}),v.filteredItems.splice(b+1,0,m)),this.setState(v,function(){return(0,i.__awaiter)(y,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,this.dispatchEvent("add",{index:u[u.length-1],indexPath:u.join("."),item:p})];case 1:return e.sent()||(!1===n?this.emitValue():this.startEdit(u.join("."),!0)),[2]}})})}),[2]})})},t.prototype.addItem=function(e,t,n){return void 0===t&&(t=!0),(0,i.__awaiter)(this,void 0,void 0,function(){var a,r,o,l,d,u,c,h,p,v,_,b,g,y,I,w=this;return(0,i.__generator)(this,function(x){return e=e||"".concat(this.state.items.length-1),a=this.props,r=a.needConfirm,o=a.scaffold,l=a.columns,d=a.data,a.perPage,u=this.state.items.concat(),(I={})[f]=!0,c=I,Array.isArray(l)&&l.forEach(function(e){if(void 0!==e.value&&"string"==typeof e.name)if(!("type"in e)||"input-date"!==e.type&&"input-datetime"!==e.type&&"input-time"!==e.type&&"input-month"!==e.type&&"input-quarter"!==e.type&&"input-year"!==e.type)(0,s.BHS)(e.value)||(0,s.BBb)(c,e.name,e.value);else if("string"!=typeof e.value||""!==e.value.trim()){var t=(0,s.PO2)(e.value,d,e.format||"X");(0,s.BBb)(c,e.name,(e.utc?m().utc(t):t).format(e.format||"X"))}}),c=(0,i.__assign)((0,i.__assign)({},c),o),!1===r&&Reflect.deleteProperty(c,f),h=e.split(".").map(function(e){return parseInt(e,10)}),(p=h.concat())[p.length-1]+=1,v=u,u=(0,s.Z6D)(u,p,0,c),this.reUseRowId(u,v,p),_=u[p[0]],(b=(0,i.__assign)((0,i.__assign)({items:u},this.transformState(u,void 0,_)),!1===r?{}:{editIndex:p.join("."),isCreateMode:!0,columns:this.buildColumns(this.props,!0,"".concat(e))})).filteredItems.includes(_)||(g=u[h[0]],y=b.filteredItems.findIndex(function(e){return e===g}),b.filteredItems.splice(y+1,0,_)),this.setState(b,function(){return(0,i.__awaiter)(w,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return t?[4,this.dispatchEvent("add",{index:p[p.length-1],indexPath:p.join("."),item:c})]:[3,2];case 1:e.sent(),e.label=2;case 2:return!1===r&&this.emitValue(),null==n||n(),[2]}})})}),[2,!1]})})},t.prototype.subAddItem=function(e,t,n){return void 0===t&&(t=!0),(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(i){return[2,this.addItem(e+".-1",t,function(){null==n||n.setExpanded(!0)})]})})},t.prototype.editItem=function(e){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,n,a;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return t=this.state.items,n=e.split(".").map(function(e){return parseInt(e,10)}),a=(0,s.Jvj)(t,n),[4,this.dispatchEvent("edit",{index:n[n.length-1],indexPath:n.join("."),item:a})];case 1:return!i.sent()&&this.startEdit(e,!0),[2]}})})},t.prototype.dispatchEvent=function(e,t){return void 0===t&&(t={}),(0,i.__awaiter)(this,void 0,void 0,function(){var n,a,r,o,l;return(0,i.__generator)(this,function(d){switch(d.label){case 0:return n=this.props.dispatchEvent,a=this.state,r=a.items,o=a.rowIndex,[4,n(e,(0,s.RKM)(this.props,(0,i.__assign)({value:(0,i.__spreadArray)([],(0,i.__read)(r),!1),rowIndex:o},t)))];case 1:return[2,!!(null==(l=d.sent())?void 0:l.prevented)]}})})},t.prototype.startEdit=function(e,t){void 0===t&&(t=!1),this.setState({editIndex:e,isCreateMode:t,columns:this.buildColumns(this.props,t,e)})},t.prototype.confirmEdit=function(){var e,t,n;return(0,i.__awaiter)(this,void 0,void 0,function(){var a,r,o,l,d,u,c,h,p,m,v,_,b,g,y,I,w,x,C=this;return(0,i.__generator)(this,function(E){switch(E.label){case 0:return a=this.props,r=a.addApi,o=a.updateApi,l=a.data,d=a.env,u=a.translate,c=[],Object.keys(this.subForms).forEach(function(e){return C.subForms[e]&&c.push(C.subForms[e])}),c.forEach(function(e){return e.flush()}),h=[],Object.keys(this.subFormItems).forEach(function(e){return C.subFormItems[e]&&h.push(C.subFormItems[e])}),h.forEach(function(e){var t,n;return null===(n=(t=e.props).onFlushChange)||void 0===n?void 0:n.call(t)}),p=c,[4,Promise.all(p.map(function(e){return e.validate()}).concat(h.map(function(e){return e.props.onValidate()})))];case 1:return~E.sent().indexOf(!1)?[2]:(m=this.state.items.concat(),v=this.state.editIndex.split(".").map(function(e){return parseInt(e,10)}),_=(0,i.__assign)({},(0,s.Jvj)(m,v)),b=_.hasOwnProperty(f),g=b?"addConfirm":"editConfirm",[4,this.dispatchEvent(g,{index:v[v.length-1],indexPath:v.join("."),item:_})]);case 2:return E.sent()?[2]:(y=null,I=void 0,b&&(0,s.Amo)(r,(0,s.ed2)(l,_))?[4,d.fetcher(r,(0,s.ed2)(l,_))]:[3,4]);case 3:return y=E.sent(),I=null===(e=null==r?void 0:r.messages)||void 0===e?void 0:e.failed,[3,6];case 4:return b||!(0,s.Amo)(o,(0,s.ed2)(l,_))?[3,6]:[4,d.fetcher(o,(0,s.ed2)(l,_))];case 5:y=E.sent(),I=null===(t=null==o?void 0:o.messages)||void 0===t?void 0:t.failed,E.label=6;case 6:return y&&!y.ok?(!(null===(n=b?r:o)||void 0===n?void 0:n.silent)&&d.notify("error",null!=I?I:y.msg||u("saveFailed")),w=b?"addFail":"editFail",this.dispatchEvent(w,{index:v[v.length-1],indexPath:v.join("."),item:_,error:y}),[2]):(y&&y.ok&&(_=(0,i.__assign)((0,i.__assign)({},(b?r:o).replaceData?{}:_),y.data)),Reflect.deleteProperty(_,f),x=m,m=(0,s.Z6D)(m,v,1,_),this.reUseRowId(m,x,v),this.setState((0,i.__assign)((0,i.__assign)({editIndex:"",items:m},this.transformState(m)),{columns:this.buildColumns(this.props)}),function(){return(0,i.__awaiter)(C,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,this.emitValue()];case 1:return t.sent()||(e=b?"addSuccess":"editSuccess",this.dispatchEvent(e,{index:v[v.length-1],indexPath:v.join("."),item:_})),[2]}})})}),[2])}})})},t.prototype.cancelEdit=function(){var e=this.state.items.concat(),t=this.state.lastModifiedRow,n=this.state.editIndex.split(".").map(function(e){return parseInt(e,10)}),a=(0,i.__assign)({},(0,s.Jvj)(e,n)),r=e;a.hasOwnProperty(f)?e=(0,s.Z6D)(e,n,1):t&&~(null==t?void 0:t.index)&&(0,s.Gvm)(null==t?void 0:t.data)&&(e=(0,s.Z6D)(e,n,1,(0,i.__assign)((0,i.__assign)({},a),t.data))),this.reUseRowId(e,r,n),this.setState((0,i.__assign)((0,i.__assign)({editIndex:"",items:e},this.transformState(e)),{columns:this.buildColumns(this.props),lastModifiedRow:void 0}),this.emitValue)},t.prototype.removeItem=function(e){var t,n;return(0,i.__awaiter)(this,void 0,void 0,function(){var a,r,o,l,d,u,c,h,p,m,f,v,_,b=this;return(0,i.__generator)(this,function(g){switch(g.label){case 0:return a=this.props,r=a.value,a.onChange,o=a.deleteApi,l=a.deleteConfirmText,d=a.env,u=a.data,c=a.translate,h=Array.isArray(r)?r.concat():[],p=e.split(".").map(function(e){return parseInt(e,10)}),(m=(0,s.Jvj)(h,p))?[4,this.dispatchEvent("delete",{index:p[p.length-1],indexPath:p.join("."),item:m})]:[2];case 1:return g.sent()?[2]:(f=(0,s.ed2)(u,m),(0,s.Amo)(o,f)?[4,d.confirm(l?(0,s.pbD)(l,f):c("deleteConfirm"))]:[3,4]);case 2:return g.sent()?[4,d.fetcher(o,f)]:[2];case 3:if(!(v=g.sent()).ok)return!(null==o?void 0:o.silent)&&d.notify("error",null!==(n=null===(t=null==o?void 0:o.messages)||void 0===t?void 0:t.failed)&&void 0!==n?n:c("deleteFailed")),this.dispatchEvent("deleteFail",{index:p[p.length-1],indexPath:p.join("."),item:m,error:v}),[2];g.label=4;case 4:return this.removeEntry(m),_=h,h=(0,s.Z6D)(h,p,1),this.reUseRowId(h,_,p),this.setState((0,i.__assign)({items:h},this.transformState(h)),function(){return(0,i.__awaiter)(b,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,this.emitValue(h)];case 1:return e.sent()||this.dispatchEvent("deleteSuccess",{value:h,index:p[p.length-1],indexPath:p.join("."),item:m}),[2]}})})}),[2]}})})},t.prototype.convertToRawPath=function(e,t){var n=(0,i.__assign)((0,i.__assign)({},this.state),t),a=n.filteredItems,s=n.items,r="".concat(e).split(".").map(function(e){return parseInt(e,10)}),o=a[r[0]];return r[0]=s.findIndex(function(e){return e===o}),-1===r[0]?e:r.join(".")},t.prototype.reUseRowId=function(e,t,n){for(var i=t,a=e,s=0,r=n.length;s<r;s++){var o=n[s];if(!(null==i?void 0:i[o])||!(null==a?void 0:a[o]))break;this.entries.set(a[o],this.entries.get(i[o])||this.entityId++),this.entries.delete(i[o]),a=a[o].children,i=i[o].children}},t.prototype.buildItemProps=function(e,t){var n={},i=this.resolveVariableProps(this.props,"minLength"),a=this.resolveVariableProps(this.props,"maxLength");return n.inputTableCanAddItem=!a||a>this.state.items.length,n.inputTableCanRemoveItem=!i||i<this.state.items.length,!1===this.props.needConfirm?(n.quickEditEnabled=!0,n):this.props.editable||this.props.addable||this.state.isCreateMode?(n.quickEditEnabled=this.state.editIndex===this.convertToRawPath(e.path),n):n},t.prototype.buildColumns=function(e,t,n){var o=this;void 0===t&&(t=!1);var d=this.props,u=d.env,c=d.enableStaticTransform,h=d.mobileUI,p=d.testIdBuilder,m=Array.isArray(e.columns)?e.columns.concat():[],v=this.props.classPrefix,_=this.props.translate,b=this.props.needConfirm,g=this.props.static,y=this.props.disabled,I=[];if(!g&&e.addable&&!1!==e.showTableAddBtn&&I.push({children:function(t){var n=t.key,i=t.rowIndexPath,s=t.inputTableCanAddItem;return o.state.editIndex&&!1!==b||!s?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:_("Table.addRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:y,onClick:o.addItem.bind(o,o.convertToRawPath(i),void 0,void 0),testIdBuilder:null==p?void 0:p.getChild("addRow-".concat(o.convertToRawPath(i)))},e.addBtnIcon?a.createElement(r.In,{cx:e.classnames,icon:e.addBtnIcon,className:"icon"}):null,e.addBtnLabel?a.createElement("span",null,e.addBtnLabel):null)}}),!g&&e.childrenAddable&&!1!==e.showTableAddBtn&&I.push({children:function(t){var n=t.key,i=t.rowIndexPath,s=t.row;return o.state.editIndex&&!1!==b?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:_("Table.subAddRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:y,onClick:o.subAddItem.bind(o,o.convertToRawPath(i),void 0,s),testIdBuilder:null==p?void 0:p.getChild("subAddRow-".concat(o.convertToRawPath(i)))},e.subAddBtnIcon?a.createElement(r.In,{cx:e.classnames,icon:e.subAddBtnIcon,className:"icon"}):null,e.subAddBtnLabel?a.createElement("span",null,e.subAddBtnLabel):null)}}),!g&&e.copyable&&!1!==e.showCopyBtn&&I.push({children:function(t){var n=t.key,i=t.rowIndexPath;return o.state.editIndex&&!1!==b?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:_("Table.copyRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:y,onClick:o.copyItem.bind(o,o.convertToRawPath(i),void 0),testIdBuilder:null==p?void 0:p.getChild("copyRow-".concat(o.convertToRawPath(i)))},e.copyBtnIcon?a.createElement(r.In,{cx:e.classnames,icon:e.copyBtnIcon,className:"icon"}):null,e.copyBtnLabel?a.createElement("span",null,e.copyBtnLabel):null)}}),!1===e.needConfirm?m=m.map(function(e){var t=e.quickEdit;return!1===t?l()(e,["quickEdit"]):(0,i.__assign)((0,i.__assign)({},e),"operation"===e.type?{}:{quickEdit:(0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.columnToQuickEdit(e)),t),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,saveImmediately:!0,mode:"inline",disabled:y,static:g||e.static})})}):!0!==g&&(e.addable||e.editable||t)?(m=m.map(function(a,r){var d=!t&&a.hasOwnProperty("quickEditOnUpdate")?a.quickEditOnUpdate:a.quickEdit,u=(0,s.CXN)(null==a?void 0:a.type);return(0,i.__assign)((0,i.__assign)({},!1===d?l()(a,["quickEdit"]):(0,i.__assign)((0,i.__assign)({},a),{quickEdit:(0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.columnToQuickEdit(a)),d),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,isQuickEditFormMode:!!(null==u?void 0:u.isFormItem),saveImmediately:!0,mode:"inline",disabled:y})})),c&&!1!==e.needConfirm?{staticOn:"".concat(!t," || data.index !== '").concat(n,"'")}:{})}),!g&&e.editable&&I.push({children:function(t){var n=t.key,i=t.rowIndexPath,s=t.data;return o.state.editIndex||s&&s.hasOwnProperty(f)?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:_("Table.editRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:y,onClick:function(){return o.editItem(o.convertToRawPath(i))},testIdBuilder:null==p?void 0:p.getChild("editRow-".concat(o.convertToRawPath(i)))},void 0!==e.updateBtnIcon?e.updateBtnIcon?a.createElement(r.In,{cx:e.classnames,icon:e.updateBtnIcon,className:"icon"}):null:e.editBtnIcon?a.createElement(r.In,{cx:e.classnames,icon:e.editBtnIcon,className:"icon"}):null,e.updateBtnLabel||e.editBtnLabel?a.createElement("span",null,e.updateBtnLabel||e.editBtnLabel):null)}}),!g&&I.push({children:function(t){var n=t.key,i=t.rowIndexPath;return o.state.editIndex===o.convertToRawPath(i)?a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:_("save"),tooltipContainer:e.popOverContainer||u.getModalContainer,onClick:o.confirmEdit,testIdBuilder:null==p?void 0:p.getChild("confirmRow-".concat(o.convertToRawPath(i)))},e.confirmBtnIcon?a.createElement(r.In,{cx:e.classnames,icon:e.confirmBtnIcon,className:"icon"}):null,e.confirmBtnLabel?a.createElement("span",null,e.confirmBtnLabel):null):null}}),!g&&I.push({children:function(t){var n=t.key,i=t.rowIndexPath;return o.state.editIndex===o.convertToRawPath(i)?a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:_("cancel"),tooltipContainer:e.popOverContainer||u.getModalContainer,onClick:o.cancelEdit,testIdBuilder:null==p?void 0:p.getChild("cancelRow-".concat(o.convertToRawPath(i)))},e.cancelBtnIcon?a.createElement(r.In,{cx:e.classnames,icon:e.cancelBtnIcon,className:"icon"}):null,e.cancelBtnLabel?a.createElement("span",null,e.cancelBtnLabel):null):null}})):m=m.map(function(e){var t=(0,s.CXN)(null==e?void 0:e.type);return(null==t?void 0:t.isFormItem)?(0,i.__assign)((0,i.__assign)({},e),{quickEdit:(0,i.__assign)((0,i.__assign)({},e),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,isFormMode:!0})}):e}),!g&&e.removable&&I.push({children:function(t){var n=t.key,i=t.rowIndexPath,s=t.data,l=t.inputTableCanRemoveItem;return(o.state.editIndex||s&&s.hasOwnProperty(f))&&!1!==b||!l?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:_("Table.deleteRow"),tooltipContainer:e.popOverContainer||u.getModalContainer,disabled:y,onClick:o.removeItem.bind(o,o.convertToRawPath(i)),testIdBuilder:null==p?void 0:p.getChild("delRow-".concat(o.convertToRawPath(i)))},e.deleteBtnIcon?a.createElement(r.In,{cx:e.classnames,icon:e.deleteBtnIcon,className:"icon"}):null,e.deleteBtnLabel?a.createElement("span",null,e.deleteBtnLabel):null)}}),I.length){var w=m.find(function(e){return"operation"===e.type});w||(w={type:"operation",buttons:[],label:_("Table.operation"),className:"v-middle nowrap",fixed:h?"":"right",width:150,innerClassName:"m-n"},m.push(w)),w.buttons=Array.isArray(w.buttons)?w.buttons.concat():[],w.buttons.unshift.apply(w.buttons,I),w.hasOwnProperty("quickEdit")&&delete w.quickEdit}return m},t.prototype.columnToQuickEdit=function(e){var t;return(null===(t=(0,s.CXN)(null==e?void 0:e.type))||void 0===t?void 0:t.isFormItem)||~["group"].indexOf(e.type)?(0,i.__assign)((0,i.__assign)({},e),{label:""}):{type:"input-text"}},t.prototype.handleTableSave=function(e,t,n){var a,r=this;this.setState(function(t,o){var l={},d=t.editIndex,u=t.lastModifiedRow,c=t.items.concat();if(Array.isArray(e))n.forEach(function(n,a){var o=(n=r.convertToRawPath(n,t)).split(".").map(function(e){return parseInt(e,10)}),l=(0,i.__assign)({},(0,s.Jvj)(e,o));c=(0,s.Z6D)(c,o,1,l)});else{if(n=r.convertToRawPath(n,t),d&&n===d){var h=d.split(".").map(function(e){return parseInt(e,10)}),p=t.items.concat(),m=(0,s.Jvj)(p,h);if(!m)return l;var v=(0,i.__assign)({},e),_=p;return p=(0,s.Z6D)(p,h,1,v),r.reUseRowId(p,_,h),Object.assign(l,(0,i.__assign)({items:p,filteredItems:t.filteredItems.map(function(e){return e===m?v:e}),rowIndex:d},(null==u?void 0:u.index)===d?{}:{lastModifiedRow:m.hasOwnProperty(f)?void 0:{index:d,data:(0,i.__assign)({},m)}})),l}var b=n.split(".").map(function(e){return parseInt(e,10)}),g=(0,i.__assign)({},e),y=c;c=(0,s.Z6D)(c,b,1,g),r.reUseRowId(c,y,b)}return Object.assign(l,(0,i.__assign)({items:c,rowIndex:n},r.transformState(c,t))),a=r.lazyEmitValue,l},function(){a&&a()})},t.prototype.handleRadioChange=function(e,t){var n,a=this,r=t.name,o=t.row,l=t.trueValue,d=void 0===l||l,u=t.falseValue,c=void 0!==u&&u;return this.setState(function(e,t){var l=o.path,u=(0,s.X$u)(e.items,function(e,t,n,a,s){var o;return(0,i.__assign)((0,i.__assign)({},e),((o={})[r]=l===s.join(".")?d:c,o))});return n=e.editIndex==o.path?void 0:a.lazyEmitValue,(0,i.__assign)({items:u},a.transformState(u))},function(){null==n||n()}),!1},t.prototype.handleSaveTableOrder=function(e,t){(0,this.props.onChange)(t.map(function(e){return(0,i.__assign)({},e)}))},t.prototype.handlePageChange=function(e){this.setState((0,i.__assign)({},this.transformState(this.state.items,{page:e})))},t.prototype.handleTableQuery=function(e){e=(0,i.__assign)((0,i.__assign)({},this.state.query),e),this.setState((0,i.__assign)({query:e},this.transformState(this.state.items,{query:e})))},t.prototype.handlePristineChange=function(e,t){var n=this,a=this.props.needConfirm,r=t.split(".").map(function(e){return parseInt(e,10)});this.setState(function(t){var a=t.items.concat(),o=(0,s.Jvj)(a,r),l=(0,i.__assign)((0,i.__assign)({},o),e),d=a;return a=(0,s.Z6D)(a,r,1,l),n.reUseRowId(a,d,r),(0,i.__assign)({items:a},n.transformState(a))},function(){!1===a&&n.emitValue()})},t.prototype.removeEntry=function(e){this.entries.has(e)&&this.entries.delete(e)},t.prototype.getEntryId=function(e){return this.entries.has(e)||this.entries.set(e,this.entityId++),String(this.entries.get(e))},t.prototype.tableRef=function(e){for(;e&&e.getWrappedInstance;)e=e.getWrappedInstance();this.table=e},t.prototype.computedAddBtnDisabled=function(){return this.props.disabled||!!this.state.editIndex},t.prototype.filterItemIndex=function(e){return this.convertToRawPath(e)},t.prototype.render=function(){var e=this,t=this.props,n=t.className,s=(t.style,t.value,t.disabled),r=t.render,o=t.placeholder,l=t.draggable,d=t.addable,u=t.columnsTogglable,c=t.combineNum,h=t.combineFromIndex,p=t.translate,m=t.canAccessSuperData,f=t.expandConfig,v=t.affixRow,_=t.prefixRow,b=t.formInited,g=t.perPage,y=t.classnames,I=t.rowClassName,w=t.rowClassNameExpr,x=t.affixHeader,C=void 0!==x&&x,E=t.autoFillHeight,A=void 0!==E&&E,P=t.tableContentClassName,R=t.static,B=t.showFooterAddBtn,k=t.footerAddBtn,F=t.toolbarClassName,S=t.onEvent,T=t.testIdBuilder,O=t.showIndex,D=this.resolveVariableProps(this.props,"maxLength");if(!1===b)return null;var j=this.state.query,N=this.state.filteredItems,V=(this.state.items,"number"==typeof g),L=this.state.page||1,q=!R&&d&&!1!==B&&(!D||D>this.state.items.length);return a.createElement("div",{className:y("InputTable",n)},r("body",{type:"table",placeholder:p(o),columns:this.state.columns,affixHeader:C,prefixRow:_,affixRow:v,autoFillHeight:A,tableContentClassName:P,onEvent:S,showIndex:O},{ref:this.tableRef,value:void 0,saveImmediately:!0,disabled:s,draggable:l&&!this.state.editIndex,items:N,getEntryId:this.getEntryId,reUseRow:"match",onSave:this.handleTableSave,onRadioChange:this.handleRadioChange,onSaveOrder:this.handleSaveTableOrder,buildItemProps:this.buildItemProps,quickEditFormRef:this.subFormRef,quickEditFormItemRef:this.subFormItemRef,columnsTogglable:u,combineNum:c,combineFromIndex:h,expandConfig:f,canAccessSuperData:m,rowClassName:I,rowClassNameExpr:w,onPristineChange:this.handlePristineChange,testIdBuilder:null==T?void 0:T.getChild("table"),onQuery:this.handleTableQuery,query:j,orderBy:null==j?void 0:j.orderBy,orderDir:null==j?void 0:j.orderDir,filterItemIndex:this.filterItemIndex}),q||V?a.createElement("div",{className:y("InputTable-toolbar",F)},q?r("button",(0,i.__assign)({type:"button",level:"primary",size:"sm",label:p("Table.add"),icon:"fa fa-plus",disabledTip:p("Table.addButtonDisabledTip")},k||{}),{disabled:this.computedAddBtnDisabled(),onClick:function(){return e.addItem()},testIdBuilder:null==T?void 0:T.getChild("add")}):null,V?r("pager",{type:"pagination"},{activePage:L,perPage:g,total:this.state.total,onPageChange:this.handlePageChange,className:"InputTable-pager",testIdBuilder:null==T?void 0:T.getChild("page"),disabled:!!this.state.editIndex}):null):null)},t.defaultProps={placeholder:"placeholder.empty",scaffold:{},addBtnIcon:"plus",subAddBtnIcon:"sub-plus",copyBtnIcon:"copy",editBtnIcon:"pencil",deleteBtnIcon:"minus",confirmBtnIcon:"check",cancelBtnIcon:"close",valueField:"",minLength:0,maxLength:1/0,showFooterAddBtn:!0,showTableAddBtn:!0},t.propsList=["onChange","name","columns","label","scaffold","showTableAddBtn","addable","removable","copyable","editable","addApi","updateApi","deleteApi","needConfirm","canAccessSuperData","formStore","footerActions","toolbarClassName"],(0,i.__decorate)([s.d6t,(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[Object,String]),(0,i.__metadata)("design:returntype",void 0)],t.prototype,"handlePristineChange",null),t}(a.Component),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.__extends)(t,e),t.prototype.setData=function(e,t,n,a){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,r,o,l,d=this;return(0,i.__generator)(this,function(u){switch(u.label){case 0:return this.state.items.length,void 0===n?[3,1]:(t=(0,i.__spreadArray)([],(0,i.__read)(this.state.items),!1),String(n).split(",").forEach(function(n){var i=n.split(".").map(function(e){return parseInt(e,10)}),a=t;t=(0,s.Z6D)(t,i,1,e),d.reUseRowId(t,a,i)}),this.setState((0,i.__assign)({items:t},this.transformState(t)),function(){d.emitValue()}),[3,4]);case 1:return void 0===a?[3,3]:(r=(0,i.__spreadArray)([],(0,i.__read)(this.state.items),!1),o=[],(0,s.IFF)(r,function(t,n,l,u,c){return o.unshift(function(){return(0,i.__awaiter)(d,void 0,void 0,function(){var o;return(0,i.__generator)(this,function(l){switch(l.label){case 0:return[4,(0,s.JnN)(a,t)];case 1:return l.sent()&&(o=r,r=(0,s.Z6D)(r,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(c),!1),[n],!1),1,e),this.reUseRowId(r,o,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(c),!1),[n],!1))),[2]}})})}),!0}),[4,Promise.all(o.map(function(e){return e()}))]);case 2:return u.sent(),this.setState((0,i.__assign)({items:r},this.transformState(r)),function(){d.emitValue()}),[3,4];case 3:l=(0,i.__spreadArray)([],(0,i.__read)(e),!1),this.setState((0,i.__assign)({items:l},this.transformState(l)),function(){d.emitValue()}),u.label=4;case 4:return[2]}})})},t.prototype.doAction=function(t,n,a,r){var o,l,d,c,h,p,m;return void 0===a&&(a=!1),(0,i.__awaiter)(this,void 0,void 0,function(){var f,v,_,b,g,y,I,w,x,C,E,A,P,R,B,k,F,S,T,O,D,j,N,V=this;return(0,i.__generator)(this,function(L){switch(L.label){case 0:return f=this.props,v=f.valueField,_=f.env,b=f.needConfirm,f.addable,g=f.addApi,y=f.deleteApi,I=f.resetValue,w=f.translate,x=f.onChange,C=f.formStore,E=f.store,A=f.name,P=t.actionType,R=(null===(o=this.props.store)||void 0===o?void 0:o.data)||{},"addItem"!==P?[3,6]:(B=this.state.items.concat(),g||r?(k=null,(0,s.Amo)(g,R)?[4,_.fetcher(g,R)]:[3,2]):[3,4]);case 1:return(D=L.sent())&&!D.ok?(!(null==g?void 0:g.silent)&&_.notify("error",null!==(d=null===(l=null==g?void 0:g.messages)||void 0===l?void 0:l.failed)&&void 0!==d?d:D.msg||w("fetchFailed")),[2]):(D&&D.ok&&(k=D.data),[3,3]);case 2:k=r.item,L.label=3;case 3:return k=(Array.isArray(k)?k:[k]).filter(function(e){return!v||!u()(B,function(t){return t[v]==e[v]})}),F=[],"string"==typeof r.index&&/^\d+(\.\d+)*$/.test(r.index)?F=r.index.split(".").map(function(e){return parseInt(e,10)}):"number"==typeof r.index&&(F=[r.index]),F.length?B=s.Z6D.apply(void 0,(0,i.__spreadArray)([B,F,0],(0,i.__read)(k),!1)):B.push.apply(B,(0,i.__spreadArray)([],(0,i.__read)(k),!1)),this.setState((0,i.__assign)({items:B},this.transformState(B)),function(){if(1===k.length&&!1!==b){var e=F.concat();e[e.length-1]+=1,V.startEdit(e.join("."),!0)}else null==x||x(B)}),[2];case 4:return[2,this.addItem("".concat(B.length-1),!1)];case 5:return[3,13];case 6:return"deleteItem"!==P?[3,12]:(S=(0,i.__spreadArray)([],(0,i.__read)(this.state.items),!1),T=[],void 0===(null==r?void 0:r.index)?[3,7]:(String(r.index).split(",").forEach(function(e){var t=e.split(".").map(function(e){return parseInt(e,10)});T.push((0,s.Jvj)(S,t)),S=(0,s.Z6D)(S,t,1)}),[3,9]));case 7:return void 0===(null==r?void 0:r.condition)?[3,9]:(O=[],(0,s.IFF)(S,function(e,t,n,a,o){return O.unshift(function(){return(0,i.__awaiter)(V,void 0,void 0,function(){return(0,i.__generator)(this,function(n){switch(n.label){case 0:return[4,(0,s.JnN)(null==r?void 0:r.condition,e)];case 1:return n.sent()&&(T.push(e),S=(0,s.Z6D)(S,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(o),!1),[t],!1),1)),[2]}})})}),!0}),[4,O.reduce(function(e,t){return e.then(t)},Promise.resolve())]);case 8:L.sent(),L.label=9;case 9:return(0,s.Amo)(y,(0,s.ed2)(R,{deletedItems:T}))?[4,_.fetcher(y,(0,s.ed2)(R,{deletedItems:T}))]:[3,11];case 10:if((D=L.sent())&&!D.ok)return!(null==y?void 0:y.silent)&&_.notify("error",null!==(h=null===(c=null==y?void 0:y.messages)||void 0===c?void 0:c.failed)&&void 0!==h?h:D.msg||w("fetchFailed")),[2];L.label=11;case 11:return this.setState((0,i.__assign)({items:S},this.transformState(S)),function(){null==x||x(S)}),[2];case 12:if("clear"===P)return this.setState({items:[]},function(){null==x||x([])}),[2];if("reset"===P)return j=null!==(m=(0,s.dnO)(null!==(p=null==C?void 0:C.pristine)&&void 0!==p?p:null==E?void 0:E.pristine,A))&&void 0!==m?m:I,N=Array.isArray(j)?j:[],this.setState((0,i.__assign)({items:N},this.transformState(N)),function(){null==x||x(N)}),[2];L.label=13;case 13:return[2,e.prototype.doAction.call(this,t,n,a,R)]}})})},(0,i.__decorate)([(0,s.eIh)({type:"input-table"})],t)}(v)}}]);