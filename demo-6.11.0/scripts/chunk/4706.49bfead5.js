"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[4706],{94706:function(e,o,t){t.r(o),t.d(o,{DialogRenderer:function(){return p},default:function(){return c}});var n=t(31635),a=t(96540),s=t(5917),r=t(25627),i=t(22451),l=t(40961),d=t(50346),c=function(e){function o(o){var t=e.call(this,o)||this;t.isDead=!1,t.$$id=(0,s.OsD)(),o.store.setEntered(!!o.show),t.handleSelfClose=t.handleSelfClose.bind(t),t.handleAction=t.handleAction.bind(t),t.handleActionSensor=t.handleActionSensor.bind(t),t.handleDialogConfirm=t.handleDialogConfirm.bind(t),t.handleDialogClose=t.handleDialogClose.bind(t),t.handleDrawerConfirm=t.handleDrawerConfirm.bind(t),t.handleDrawerClose=t.handleDrawerClose.bind(t),t.handleEntered=t.handleEntered.bind(t),t.handleExited=t.handleExited.bind(t),t.handleFormInit=t.handleFormInit.bind(t),t.handleFormSaved=t.handleFormSaved.bind(t),t.handleFormChange=t.handleFormChange.bind(t),t.handleChildFinished=t.handleChildFinished.bind(t);var n=o.store;return t.reaction=(0,i.reaction)(function(){return"".concat(n.loading).concat(n.error)},function(){return t.forceUpdate()}),t}return(0,n.__extends)(o,e),o.prototype.componentWillUnmount=function(){this.reaction&&this.reaction(),this.isDead=!0},o.prototype.buildActions=function(){var e=this.props,o=e.actions,t=e.confirm,n=e.translate,a=e.testIdBuilder;if(void 0!==o)return o;var s=[];return s.push({type:"button",testIdBuilder:null==a?void 0:a.getChild("cancel"),actionType:"cancel",label:n("cancel")}),t&&s.push({type:"button",testIdBuilder:null==a?void 0:a.getChild("confirm"),actionType:"confirm",label:n("confirm"),primary:!0}),s},o.prototype.handleSelfClose=function(e,o){return(0,n.__awaiter)(this,void 0,void 0,function(){var e,t,a,s;return(0,n.__generator)(this,function(n){switch(n.label){case 0:return e=this.props,t=e.onClose,a=e.store,[4,(0,e.dispatchEvent)("cancel",this.props.data)];case 1:return(null==(s=n.sent())?void 0:s.prevented)?[2]:(null==s?void 0:s.pendingPromise.length)?[4,s.allDone()]:[3,3];case 2:n.sent(),n.label=3;case 3:return a.updateMessage(),t(o),[2]}})})},o.prototype.handleActionSensor=function(e){var o=this,t=this.props.store,n=t.busying;t.markBusying(!0),t.updateMessage(),e.then(function(){t.markBusying(n)}).catch(function(e){o.isDead||(t.updateMessage(e.message,!0),t.markBusying(n))})},o.prototype.handleAction=function(e,o,t){var n=this.props,a=n.store,s=n.onAction;"reset"===o.type?a.reset():"cancel"===o.actionType?this.handleSelfClose():s&&s(e,o,t)},o.prototype.handleDialogConfirm=function(e,o){for(var t=[],a=2;a<arguments.length;a++)t[a-2]=arguments[a];var s=this.props.store;o.mergeData&&1===e.length&&e[0]&&s.updateData(e[0]);var r=s.action.dialog;r&&r.onConfirm&&!1===r.onConfirm.apply(r,(0,n.__spreadArray)([e,o],(0,n.__read)(t),!1))||s.closeDialog(!0,e)},o.prototype.handleDialogClose=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var t=this.props.store,a=t.action.dialog;a.onClose&&!1===a.onClose.apply(a,(0,n.__spreadArray)([],(0,n.__read)(e),!1))||t.closeDialog(e[1])},o.prototype.handleDrawerConfirm=function(e,o){for(var t=[],a=2;a<arguments.length;a++)t[a-2]=arguments[a];var s=this.props.store;o.mergeData&&1===e.length&&e[0]&&s.updateData(e[0]);var r=s.action.drawer;r&&r.onConfirm&&!1===r.onConfirm.apply(r,(0,n.__spreadArray)([e,o],(0,n.__read)(t),!1))||s.closeDrawer(!0,e)},o.prototype.handleDrawerClose=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var t=this.props.store,a=t.action.drawer;a.onClose&&!1===a.onClose.apply(a,(0,n.__spreadArray)([],(0,n.__read)(e),!1))||t.closeDrawer.apply(t,(0,n.__spreadArray)([],(0,n.__read)(e),!1))},o.prototype.handleEntered=function(){var e=this.props,o=e.lazySchema,t=e.store;t.setEntered(!0),t.markBusying(!1),"function"==typeof o&&t.setSchema(o(this.props));var n=document.activeElement;if(n){var a=(0,l.findDOMNode)(this);a&&!a.contains(n)&&n.blur()}},o.prototype.handleExited=function(){var e=this.props,o=e.lazySchema,t=e.store,n=e.statusStore;n&&(0,d.isAlive)(n)&&n.resetAll(),(0,d.isAlive)(t)&&(t.reset(),t.clearMessage(),t.markBusying(!1),t.setEntered(!1),"function"==typeof o&&t.setSchema(""))},o.prototype.handleFormInit=function(e){this.props.store.setFormData(e)},o.prototype.handleFormChange=function(e,o){var t=this.props.store;"string"!=typeof o?t.setFormData(e):t.changeValue(o,e)},o.prototype.handleFormSaved=function(e,o){this.props.store.setFormData((0,n.__assign)((0,n.__assign)({},e),o))},o.prototype.handleChildFinished=function(e,o){},o.prototype.openFeedback=function(e,o){var t=this;return new Promise(function(n){var a=t.props.store;a.setCurrentAction({type:"button",actionType:"dialog",dialog:e},t.props.resolveDefinitions),a.openDialog(o,void 0,function(e){n(e)},t.context)})},o.prototype.getPopOverContainer=function(){return(0,l.findDOMNode)(this).querySelector(".".concat(this.props.classPrefix,"Modal-content"))},o.prototype.renderBody=function(e,o){var t=this,a=this.props,s=a.render,r=a.store;if(Array.isArray(e))return e.map(function(e,o){return t.renderBody(e,o)});var i={key:o,disabled:e&&e.disabled||r.loading,onAction:this.handleAction,onFinished:this.handleChildFinished,popOverContainer:this.getPopOverContainer,onChange:this.handleFormChange,onInit:this.handleFormInit,onSaved:this.handleFormSaved,onActionSensor:this.handleActionSensor,btnDisabled:r.loading,syncLocation:!1};if(!e.type)return s("body".concat(o?"/".concat(o):""),e,i);var l=e;return"form"===l.type&&(l=(0,n.__assign)({mode:"horizontal",wrapWithPanel:!1,submitText:null},l)),s("body".concat(o?"/".concat(o):""),l,i)},o.prototype.renderFooter=function(){var e=this,o=this.buildActions(),t=this.props.hideActions;if(!o||!o.length||t)return null;var n=this.props,s=n.store,i=n.render,l=n.env,d=n.classnames,c=n.showErrorMsg,p=n.showLoading,h=n.show,u=n.dialogFooterClassName;return a.createElement("div",{className:d("Modal-footer",u)},!1!==p&&s.loading||!1!==c&&s.error?a.createElement("div",{className:d("Dialog-info"),key:"info"},!1!==p?a.createElement(r.y$,{size:"sm",key:"info",show:s.loading}):null,!l.forceSilenceInsideError&&s.error&&!1!==c?a.createElement("span",{className:d("Dialog-error")},s.msg):null):null,o.map(function(o,t){return i("action/".concat(t),o,{data:s.formData,onAction:e.handleAction,onActionSensor:void 0,btnDisabled:s.loading,key:t,disabled:o.disabled||s.loading||!h})}))},o.prototype.render=function(){var e=this.props.store,o=(0,n.__assign)((0,n.__assign)({},this.props),e.schema),t=o.className,i=o.style,l=o.size,d=o.height,c=o.width,p=o.closeOnEsc,h=o.closeOnOutside,u=o.title,m=o.render,g=o.header,f=o.body,y=o.bodyClassName,C=o.headerClassName,v=o.show,_=o.lazyRender,D=o.lazySchema,b=o.wrapperComponent,w=o.showCloseButton,A=o.env,N=o.classnames,T=o.classPrefix,E=o.translate,S=o.loadingConfig,x=o.overlay,k=o.dialogType,O=o.cancelText,M=o.confirmText,F=o.confirmBtnLevel,B=o.cancelBtnLevel,z=(o.popOverContainer,o.inDesign,o.themeCss),P=o.id,H=(0,n.__rest)(o,["className","style","size","height","width","closeOnEsc","closeOnOutside","title","render","header","body","bodyClassName","headerClassName","show","lazyRender","lazySchema","wrapperComponent","showCloseButton","env","classnames","classPrefix","translate","loadingConfig","overlay","dialogType","cancelText","confirmText","confirmBtnLevel","cancelBtnLevel","popOverContainer","inDesign","themeCss","id"]),I=b||r.aF;return a.createElement(I,(0,n.__assign)({},H,{classPrefix:T,className:N(t),style:i,size:l,height:d,width:c,modalClassName:(0,s.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"dialogClassName",id:P,themeCss:z})),modalMaskClassName:(0,s.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"dialogMaskClassName",id:P,themeCss:z})),backdrop:"static",onHide:this.handleSelfClose,keyboard:p&&!e.loading,closeOnEsc:p,closeOnOutside:!e.dialogOpen&&h,show:v,onEntered:this.handleEntered,onExited:this.handleExited,container:null==A?void 0:A.getModalContainer,enforceFocus:!1,disabled:e.loading,overlay:x,dialogType:k,cancelText:O,confirmText:M,confirmBtnLevel:F,cancelBtnLevel:B}),u&&"string"==typeof u?a.createElement("div",{className:N("Modal-header",C,(0,s.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"dialogHeaderClassName",id:P,themeCss:z})))},!1===w||e.loading?null:a.createElement("a",{"data-tooltip":E("Dialog.close"),"data-position":"left",onClick:this.handleSelfClose,className:N("Modal-close")},a.createElement(r.In,{icon:"close",className:"icon",iconContent:"Dialog-close"})),a.createElement("div",{className:N("Modal-title",(0,s.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"dialogTitleClassName",id:P,themeCss:z})))},(0,s.pbD)(E(u),e.formData))):u?a.createElement("div",{className:N("Modal-header",C,(0,s.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"dialogHeaderClassName",id:P,themeCss:z})))},!1===w||e.loading?null:a.createElement("a",{"data-tooltip":E("Dialog.close"),onClick:this.handleSelfClose,className:N("Modal-close")},a.createElement(r.In,{icon:"close",className:"icon",iconContent:"Dialog-close"})),m("title",u,{data:e.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading})):!1===w||e.loading?null:a.createElement("a",{"data-tooltip":E("Dialog.close"),onClick:this.handleSelfClose,className:N("Modal-close")},a.createElement(r.In,{icon:"close",className:"icon",iconContent:"Dialog-close"})),g?m("header",g,{data:e.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading}):null,!e.entered&&_||D&&!f?a.createElement("div",{className:N("Modal-body",y,(0,s.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"dialogBodyClassName",id:P,themeCss:z}))),role:"dialog-body"},a.createElement(r.y$,{overlay:!0,show:!0,size:"lg",loadingConfig:S})):f?a.createElement("div",{className:N("Modal-body",y,(0,s.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"dialogBodyClassName",id:P,themeCss:z}))),role:"dialog-body"},this.renderBody(f,"body"),a.createElement(s.z4D,(0,n.__assign)({},this.props,{config:{themeCss:z,classNames:[{key:"dialogClassName"},{key:"dialogMaskClassName"},{key:"dialogHeaderClassName"},{key:"dialogTitleClassName"},{key:"dialogBodyClassName"},{key:"dialogFooterClassName"}],id:P},env:A}))):null,f?this.renderFooter():null,f?m("drawer",(0,n.__assign)((0,n.__assign)({},e.action&&e.action.drawer),{type:"drawer"}),{key:"drawer",data:e.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:e.drawerOpen,onAction:this.handleAction}):null,f?m("dialog",(0,n.__assign)((0,n.__assign)({},e.action&&e.action.dialog),{type:"dialog"}),{key:"dialog",data:e.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:e.dialogOpen,onAction:this.handleAction}):null)},o.propsList=["title","size","closeOnEsc","closeOnOutside","children","bodyClassName","headerClassName","confirm","onClose","onConfirm","show","body","showCloseButton","showErrorMsg","actions","popOverContainer","overlay","draggable"],o.defaultProps={title:"Dialog.title",bodyClassName:"",confirm:!0,show:!1,lazyRender:!1,showCloseButton:!0,wrapperComponent:r.aF,closeOnEsc:!1,closeOnOutside:!1,showErrorMsg:!0},(0,n.__decorate)([s.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],o.prototype,"getPopOverContainer",null),o}(a.Component),p=function(e){function o(o,t){var n=e.call(this,o)||this;return t.registerComponent(n),n}return(0,n.__extends)(o,e),o.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this),clearTimeout(this.clearErrorTimer)},o.prototype.tryChildrenToHandle=function(e,o,t){var a=this,s=this.context,r=[],i=this.props,l=i.onConfirm,d=i.store;if(e.target&&r.push.apply(r,(0,n.__spreadArray)([],(0,n.__read)(e.target.split(",").map(function(e){return s.getComponentByName(e)}).filter(function(e){return e&&e.doAction})),!1)),!0!==(null==e?void 0:e.isolateScope)&&!r.length)for(var c=s.getComponents().filter(function(e){return!~["drawer","dialog"].indexOf(e.props.type)}),p=c.concat();p.length;){var h=p.pop();if(~["crud","form","wizard"].indexOf(h.props.type)){r.push(h);break}~["drawer","dialog"].indexOf(h.props.type)||~["page","service"].indexOf(h.props.type)&&p.unshift.apply(p,h.context.getComponents())}return!!r.length&&(d.markBusying(!0),d.updateMessage(),Promise.all(r.map(function(t){return t.doAction((0,n.__assign)((0,n.__assign)({},e),{from:a.$$id}),o,!0)})).then(function(n){"submit"!==e.type&&"submit"!==e.actionType&&"confirm"!==e.actionType||!1===e.close||r.some(function(e){return!1===e.props.closeDialogOnSubmit})?e.close&&(!0===e.close?a.handleSelfClose():a.closeTarget(e.close)):l&&l(n,t||e,o,r),d.markBusying(!1)}).catch(function(e){a.isDead||(d.updateMessage(e.message,!0),d.markBusying(!1),clearTimeout(a.clearErrorTimer),a.clearErrorTimer=setTimeout(function(){a.isDead||d.updateMessage("")},3e3))}),!0)},o.prototype.doAction=function(e,o,t){this.handleAction(void 0,e,o)},o.prototype.handleAction=function(e,o,t,a,r,i){return void 0===a&&(a=!1),(0,n.__awaiter)(this,void 0,void 0,function(){var l,d,c,p,h,u,m,g,f,y,C,v=this;return(0,n.__generator)(this,function(_){switch(_.label){case 0:return l=this.props,d=l.onAction,c=l.store,p=l.onConfirm,h=l.env,u=l.dispatchEvent,m=l.onClose,g=l.show,o.from!==this.$$id&&g?(null==i?void 0:i.pendingPromise.length)?[4,i.allDone()]:[3,2]:[2,!!d&&d(e,o,t,a,r||this.context)];case 1:_.sent(),_.label=2;case 2:return f=this.context,"reset"!==o.type?[3,3]:(c.setCurrentAction(o,this.props.resolveDefinitions),c.reset(),[3,19]);case 3:return"close"!==o.actionType&&"cancel"!==o.actionType?[3,7]:[4,u("cancel",(0,s.ed2)(this.props.data,t))];case 4:return(null==(y=_.sent())?void 0:y.prevented)?[2]:(null==y?void 0:y.pendingPromise.length)?[4,y.allDone()]:[3,6];case 5:_.sent(),_.label=6;case 6:return c.setCurrentAction(o,this.props.resolveDefinitions),c.updateMessage(),m(),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),[3,19];case 7:return"confirm"!==o.actionType?[3,11]:[4,u("confirm",(0,s.ed2)(this.props.data,t))];case 8:return(null==(C=_.sent())?void 0:C.prevented)?[2]:(null==C?void 0:C.pendingPromise.length)?[4,C.allDone()]:[3,10];case 9:_.sent(),_.label=10;case 10:return c.setCurrentAction(o,this.props.resolveDefinitions),this.tryChildrenToHandle((0,n.__assign)((0,n.__assign)({},o),{actionType:"submit"}),t,o)||(c.updateMessage(),!1!==o.close&&m(!0)),[3,19];case 11:return"next"!==o.actionType&&"prev"!==o.actionType?[3,12]:(c.setCurrentAction(o,this.props.resolveDefinitions),"submit"===o.type?this.tryChildrenToHandle((0,n.__assign)((0,n.__assign)({},o),{actionType:"submit",close:!0}),t,o)||this.handleSelfClose(void 0,!0):p([t],o,t,[]),[3,19]);case 12:return"dialog"!==o.actionType?[3,13]:(c.setCurrentAction(o,this.props.resolveDefinitions),[2,new Promise(function(e){c.openDialog(t,void 0,function(t,n){var a;null===(a=o.callback)||void 0===a||a.call(o,t,n),e({confirmed:t,value:n})},r||v.context)})]);case 13:return"drawer"!==o.actionType?[3,14]:(c.setCurrentAction(o,this.props.resolveDefinitions),[2,new Promise(function(e){c.openDrawer(t,void 0,function(t,n){var a;null===(a=o.callback)||void 0===a||a.call(o,t,n),e({confirmed:t,value:n})})})]);case 14:return"reload"!==o.actionType?[3,15]:(c.setCurrentAction(o,this.props.resolveDefinitions),o.target&&f.reload(o.target,t),(o.close||"submit"===o.type)&&(this.handleSelfClose(void 0,"submit"===o.type),o.close&&"string"==typeof o.close&&this.closeTarget(o.close)),[3,19]);case 15:return o.from||!this.tryChildrenToHandle(o,t)?[3,16]:[3,19];case 16:return"ajax"!==o.actionType?[3,17]:(c.setCurrentAction(o,this.props.resolveDefinitions),[2,c.saveRemote(o.api,t,{successMessage:o.messages&&o.messages.success,errorMessage:o.messages&&o.messages.failed}).then(function(){return(0,n.__awaiter)(v,void 0,void 0,function(){var e;return(0,n.__generator)(this,function(t){switch(t.label){case 0:return o.feedback&&(0,s.zNq)(o.feedback,c.data)?[4,this.openFeedback(o.feedback,c.data)]:[3,2];case 1:t.sent(),t.label=2;case 2:return(e=o.redirect&&(0,s.pbD)(o.redirect,c.data))&&h.jumpTo(e,o,c.data),o.reload&&this.reloadTarget((0,s.Wvn)(o.reload,c.data),c.data),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),[2]}})})}).catch(function(e){if(a||o.countDown)throw e})]);case 17:return d?[4,d(e,(0,n.__assign)((0,n.__assign)({},o),{close:!1}),t,a,r||this.context)]:[3,19];case 18:_.sent(),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),_.label=19;case 19:return[2]}})})},o.prototype.handleChildFinished=function(e,o){if(!(o&&o.from===this.$$id||!1===o.close)){var t=this.context.getComponents().filter(function(e){return!~["drawer","dialog","action","button","submit","reset"].indexOf(e.props.type)}),n=this.props.onConfirm,a=this.props.onClose;1!==t.length||"form"!==t[0].props.type&&"wizard"!==t[0].props.type||!0!==o.close&&!1===t[0].props.closeDialogOnSubmit?!0===o.close&&a():n&&n([e],o,{},t)}},o.prototype.handleDialogConfirm=function(o,t){for(var a,s,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];e.prototype.handleDialogConfirm.apply(this,(0,n.__spreadArray)([o,t],(0,n.__read)(r),!1));var l=this.props.store,d=l.getDialogScoped()||this.context,c=l.action,p=null!==(a=t.reload)&&void 0!==a?a:c.reload;p?d.reload(p,l.data):d.component!==this&&(null===(s=d.component)||void 0===s?void 0:s.reload)?d.component.reload():this.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},o.prototype.handleDrawerConfirm=function(o,t){for(var n,a=this,s=[],r=2;r<arguments.length;r++)s[r-2]=arguments[r];e.prototype.handleDrawerConfirm.call(this,o,t);var i=this.props.store,l=i.getDialogScoped()||this.context,d=i.action,c=null!==(n=t.reload)&&void 0!==n?n:d.reload;setTimeout(function(){var e;c?l.reload(c,i.data):l.component!==a&&(null===(e=l.component)||void 0===e?void 0:e.reload)?l.component.reload():a.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},300)},o.prototype.reloadTarget=function(e,o){this.context.reload(e,o)},o.prototype.closeTarget=function(e){this.context.close(e)},o.prototype.setData=function(e,o){return this.props.store.updateData(e,void 0,o)},o.prototype.getData=function(){return this.props.store.data},o.contextType=s.MzX,(0,n.__decorate)([(0,s.A49)({type:"dialog",storeType:s.P2M.name,storeExtendsData:!1,isolateScope:!0,shouldSyncSuperStore:function(e,o,t){return!(!e.dialogOpen&&!o.show||o.show===t.show&&!(0,s.JQ)(t.data,o.data))}}),(0,n.__metadata)("design:paramtypes",[Object,Object])],o)}(c)}}]);