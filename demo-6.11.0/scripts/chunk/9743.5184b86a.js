"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[9743],{99743:function(e,t,n){n.r(t),n.d(t,{MatrixRenderer:function(){return u},default:function(){return l}});var r=n(31635),o=n(96540),i=n(5917),a=n(25627),s=n(66283),l=function(e){function t(t){var n=e.call(this,t)||this;return n.mounted=!1,n.toDispose=[],n.state={columns:t.columns||[],rows:t.rows||[],loading:!1},n.toggleItem=n.toggleItem.bind(n),n.reload=n.reload.bind(n),n.initOptions=n.initOptions.bind(n),n.mounted=!0,n}return(0,r.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.formInited,n=e.addHook,r=e.formItem;r&&this.toDispose.push(t||!n?r.addInitHook(this.initOptions):n(this.initOptions,"init"))},t.prototype.componentDidUpdate=function(e){var t=this.props;if(e.columns!==t.columns||e.rows!==t.rows)this.setState({columns:t.columns||[],rows:t.rows||[]});else if(t.formInited&&(t.source!==e.source||e.data!==t.data)){var n=(0,i.lSp)(e.source,e.data,{ignoreData:!0}),r=(0,i.lSp)(t.source,t.data,{ignoreData:!0});n.url!==r.url&&(0,i.FlT)(r.url)&&this.reload()}},t.prototype.componentWillUnmount=function(){this.mounted=!1,this.toDispose.forEach(function(e){return e()}),this.toDispose=[]},t.prototype.doAction=function(e,t,n){var r,o,a=this.props,s=a.resetValue,l=a.onChange,c=a.formStore,u=a.store,d=a.name,h=null==e?void 0:e.actionType;if("clear"===h)null==l||l("");else if("reset"===h){var p=null!==(o=(0,i.dnO)(null!==(r=null==c?void 0:c.pristine)&&void 0!==r?r:null==u?void 0:u.pristine,d))&&void 0!==o?o:s;null==l||l(null!=p?p:"")}},t.prototype.initOptions=function(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,this.reload()];case 1:return r.sent(),t=this.props,n=t.formItem,o=t.name,n?(n.value&&(0,i.BBb)(e,o,n.value),[2]):[2]}})})},t.prototype.reload=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,t,n,o,a,s,l=this;return(0,r.__generator)(this,function(c){switch(c.label){case 0:if(e=this.props,t=e.source,n=e.data,o=e.env,a=e.onChange,s=e.translate,!(0,i.Amo)(t,n)||this.state.loading)return[2];if(!o||!o.fetcher)throw new Error("fetcher is required");return[4,new Promise(function(e,i){if(!l.mounted)return e();l.setState({loading:!0},function(){if(!l.mounted)return e();o.fetcher(t,n).then(function(n){if(!n.ok)throw new Error(n.msg||s("fetchFailed"));if(!l.mounted)return e();l.setState({loading:!1,rows:n.data.rows||[],columns:n.data.columns||[]},function(){t&&t.replaceData;var o=n.data.value;o&&(o=t.replaceData?o:function(e,t,n){return e.map(function(e,o){return e.map(function(e,i){return(0,r.__assign)((0,r.__assign)((0,r.__assign)({},t[o]),n[i]),e)})})}(o,l.state.columns,l.state.rows),a(o)),e()})}).catch(function(t){return l.setState({error:t,loading:!1},function(){return e()})})})})];case 1:return[2,c.sent()]}})})},t.prototype.toggleItem=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var o,a,s,l,u,d,h,p,m,f,g,_,v;return(0,r.__generator)(this,function(k){switch(k.label){case 0:if(o=this.state,a=o.columns,s=o.rows,l=this.props,u=l.multiple,d=l.singleSelectMode,h=l.dispatchEvent,l.data,p=this.props.value||c(a,s),u)p[t][n]=(0,r.__assign)((0,r.__assign)({},p[t][n]),{checked:e});else if("row"===d)for(g=0,f=a.length;g<f;g++)p[g][n]=(0,r.__assign)((0,r.__assign)({},p[g][n]),{checked:t===g?e:!e});else if("column"===d)for(m=0,f=s.length;m<f;m++)p[t][m]=(0,r.__assign)((0,r.__assign)({},p[t][m]),{checked:n===m?e:!e});else for(m=0,f=s.length;m<f;m++)for(g=0,_=a.length;g<_;g++)p[g][m]=(0,r.__assign)((0,r.__assign)({},p[g][m]),{checked:t===g&&n===m?e:!e});return[4,h("change",(0,i.RKM)(this.props,{value:p.concat()}))];case 1:return(null==(v=k.sent())?void 0:v.prevented)||this.props.onChange(p.concat()),[2]}})})},t.prototype.isColumChecked=function(e,t){var n=e[t];return!!n&&n.some(function(e){return e&&e.checked})},t.prototype.isColumnPartialChecked=function(e,t){var n=e[t];if(!n||1==n.length)return!1;var r=n[0].checked;return n.some(function(e){return e.checked!==r})&&!n.every(function(e){return e.checked===r})},t.prototype.toggleColumnCheckAll=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var o,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:o=t[n],i=0,r.label=1;case 1:return i<o.length?[4,this.toggleItem(e,n,i)]:[3,4];case 2:r.sent(),r.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},t.prototype.isRowChecked=function(e,t){return e&&e.some(function(e){return e[t]&&e[t].checked})},t.prototype.isRowPartialChecked=function(e,t){if(!e||1==e.length)return!1;var n=e[0][t].checked;return e.some(function(e){return n!==e[t].checked})&&!e.every(function(e){return e.checked})},t.prototype.toggleRowCheckAll=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:o=0,r.label=1;case 1:return o<t.length?[4,this.toggleItem(e,o,n)]:[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return[2]}})})},t.prototype.renderInput=function(e){var t=this;void 0===e&&(e=!1);var n=this.state,r=n.columns,s=n.rows,l=this.props,u=l.rowLabel,d=l.disabled,h=l.classnames,p=l.multiple,m=l.textAlign,f=l.xCheckAll,g=l.yCheckAll,_=l.testIdBuilder,v=this.props.value||c(r,s);return o.createElement("div",{className:h("Table m-b-none",{"is-mobile":(0,i.FrL)()})},o.createElement("div",{className:h("Table-content")},o.createElement("table",{className:h("Table-table")},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",null,u),r.map(function(n,r){return o.createElement("th",{key:r,className:"text-"+(m||p?"left":"center")},p&&g?o.createElement(a.Sc,{type:"checkbox",disabled:e||d,checked:t.isColumChecked(v,r),partial:t.isColumnPartialChecked(v,r),onChange:function(e){return t.toggleColumnCheckAll(e,v,r)}}):null,n.label)}))),o.createElement("tbody",null,s.map(function(n,i){return o.createElement("tr",{key:i},o.createElement("td",null,p&&f?o.createElement(a.Sc,{type:"checkbox",disabled:e||d,checked:t.isRowChecked(v,i),partial:t.isRowPartialChecked(v,i),onChange:function(e){return t.toggleRowCheckAll(e,v,i)},testIdBuilder:null==_?void 0:_.getChild(i)}):null,n.label,n.description||n.desc?o.createElement("span",{className:"m-l-xs text-muted text-xs"},n.description||n.desc):null),r.map(function(n,r){return o.createElement("td",{key:r,className:"text-"+(m||p?"left":"center")},o.createElement(a.Sc,{type:p?"checkbox":"radio",disabled:e||d,checked:!!(v[r]&&v[r][i]&&v[r][i].checked),onChange:function(e){return t.toggleItem(e,r,i)},testIdBuilder:null==_?void 0:_.getChild("".concat(r,"-").concat(i))}))}))})))))},t.prototype.renderStatic=function(e){void 0===e&&(e="-");var t=this.props,n=t.className,r=(t.render,t.classnames),i=this.state.error;return o.createElement("div",{key:"input",className:r("MatrixControl",n||"")},i?e:this.renderInput(!0))},t.prototype.render=function(){var e=this.props,t=e.className,n=(e.render,e.classnames),r=e.loadingConfig,i=this.state,s=i.error,l=i.loading;return o.createElement("div",{key:"input",className:n("MatrixControl",t||"")},s?o.createElement("div",{className:n("MatrixControl-error Alert Alert--danger")},String(s)):this.renderInput(),o.createElement(a.y$,{size:"lg",overlay:!0,key:"info",show:l,loadingConfig:r}))},t.defaultProps={columns:[],rows:[],multiple:!0,singleSelectMode:"column"},(0,r.__decorate)([(0,s.E)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[]),(0,r.__metadata)("design:returntype",void 0)],t.prototype,"render",null),t}(o.Component);function c(e,t){return Array.isArray(e)||(e=[]),Array.isArray(t)||(t=[]),e.map(function(e){return t.map(function(t){return(0,r.__assign)((0,r.__assign)((0,r.__assign)({},t),e),{checked:!1})})})}var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),(0,r.__decorate)([(0,i.eIh)({type:"matrix-checkboxes",strictMode:!1,sizeMutable:!1})],t)}(l)}}]);