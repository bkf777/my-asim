"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[9584],{69584:function(e,t,n){n.r(t),n.d(t,{OfficeViewerRenderer:function(){return l},default:function(){return s}});var r=n(31635),i=n(96540),o=n(5917),a=n(25627),s=function(e){function t(t){var n=e.call(this,t)||this;return n.rootElement=i.createRef(),n.state={loading:!1},n}return(0,r.__extends)(t,e),t.prototype.componentDidMount=function(){var e;(null===(e=this.rootElement)||void 0===e?void 0:e.current)&&this.renderWord()},t.prototype.componentDidUpdate=function(e){var t,n,r=this;if(!this.state.loading){var i=this.props;(0,o.B92)(e.src,i.src,e.data,i.data)&&this.fetchWord().then(function(){r.renderWord()}),i.name&&e.data[i.name]!==i.data[i.name]&&this.renderWord(),JSON.stringify(e.wordOptions)===JSON.stringify(i.wordOptions)&&e.display===i.display||this.renderWord(),(null===(t=i.wordOptions)||void 0===t?void 0:t.enableVar)&&(i.trackExpression&&(0,o.pbD)(i.trackExpression,i.data)!==(0,o.pbD)(e.trackExpression,e.data)?this.renderWord():null===(n=this.office)||void 0===n||n.updateVariable())}},t.prototype.doAction=function(e,t,n,r){var i,o,a=null==e?void 0:e.actionType;"saveAs"===a&&(null===(i=this.office)||void 0===i||i.download((null==r?void 0:r.name)||this.fileName)),"print"===a&&(null===(o=this.office)||void 0===o||o.print())},t.prototype.evalVar=function(e,t){var n=this.props.data;return(0,o.GvO)("${"+e+"}",(0,o.ed2)(t,n),"| raw")},t.prototype.renderWord=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,t,n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return e=this.props,t=e.src,n=e.name,t?this.document?[3,2]:[4,this.fetchWord()]:[3,4];case 1:r.sent(),r.label=2;case 2:return[4,this.renderRemoteWord()];case 3:return r.sent(),[3,5];case 4:n&&this.renderFormFile(),r.label=5;case 5:return[2]}})})},t.prototype.fetchWord=function(){var e;return(0,r.__awaiter)(this,void 0,void 0,function(){var t,n,i,a,s,l,c,d;return(0,r.__generator)(this,function(r){switch(r.label){case 0:if(t=this.props,n=t.env,i=t.src,a=t.data,s=t.translate,"string"==typeof(c=i?(0,o.GvO)(i,a,"| raw"):void 0)?(l=c,this.fileName=l.split("/").pop()):"object"==typeof c&&"string"==typeof c.value&&(l=c.value,this.fileName=c.name||l.split("/").pop()),!l)return console.warn("file src is empty"),[2];this.finalSrc=l,this.setState({loading:!0}),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,n.fetcher(l,a,{responseType:"arraybuffer"})];case 2:return d=r.sent(),this.document=d.data,[3,5];case 3:return r.sent(),(null===(e=this.rootElement)||void 0===e?void 0:e.current)&&(this.rootElement.current.innerHTML=s("loadingFailed")+" url:"+l),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},t.prototype.initOffice=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,a,s;return(0,r.__generator)(this,function(l){switch(l.label){case 0:return n=this.props,i=n.wordOptions,o=n.excelOptions,n.env,n.src,a=n.data,n.translate,[4,(0,e.createOfficeViewer)(t||this.document,{},this.finalSrc)];case 1:return(s=l.sent())instanceof e.Word?(s.updateOptions((0,r.__assign)((0,r.__assign)({},i),{data:a,evalVar:this.evalVar.bind(this)})),[3,4]):[3,2];case 2:return s instanceof e.Excel?(s.updateOptions((0,r.__assign)((0,r.__assign)({},o),{data:a,evalVar:this.evalVar.bind(this)})),[4,s.loadExcel()]):[3,4];case 3:l.sent(),l.label=4;case 4:return[2,s]}})})},t.prototype.renderRemoteWord=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,t,i=this;return(0,r.__generator)(this,function(o){return(e=this.props).wordOptions,e.excelOptions,e.env,e.src,e.data,t=e.display,e.translate,this.document?(n.e(5021).then(n.bind(n,55021)).then(function(e){return(0,r.__awaiter)(i,void 0,void 0,function(){var n,i,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,this.initOffice(e)];case 1:return n=r.sent(),!1!==t?n.render(null===(i=this.rootElement)||void 0===i?void 0:i.current):!1===t&&(null===(o=this.rootElement)||void 0===o?void 0:o.current)&&(this.rootElement.current.innerHTML=""),this.office=n,this.setState({loading:!1}),[2]}})})}),[2]):[2]})})},t.prototype.renderFormFile=function(){var e=this;this.setState({loading:!0});var t=this.props,i=(t.wordOptions,t.name),o=t.data,a=t.display,s=o[i];if(s instanceof File){var l=new FileReader;l.onload=function(t){var i=l.result;n.e(5021).then(n.bind(n,55021)).then(function(t){return(0,r.__awaiter)(e,void 0,void 0,function(){var e,n,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,this.initOffice(t,i)];case 1:return e=r.sent(),!1!==a?e.render(null===(n=this.rootElement)||void 0===n?void 0:n.current):!1===a&&(null===(o=this.rootElement)||void 0===o?void 0:o.current)&&(this.rootElement.current.innerHTML=""),this.office=e,this.setState({loading:!1}),[2]}})})})},l.readAsArrayBuffer(s)}else this.setState({loading:!1})},t.prototype.render=function(){var e=this.props,t=e.classnames,n=(e.translate,e.className),r=e.loading,o=void 0!==r&&r,s=e.src,l=e.name,c=e.display,d=e.loadingConfig;return i.createElement("div",null,!1!==c&&!s&&!l&&i.createElement("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg"},i.createElement("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),i.createElement("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555"},"office viewer")),i.createElement("div",{ref:this.rootElement,className:t("office-viewer",n)}),i.createElement(a.y$,{overlay:!0,key:"info",show:o&&this.state.loading,loadingConfig:d}))},t}(i.Component),l=function(e){function t(t,n){var r=e.call(this,t)||this;return n.registerComponent(r),r}return(0,r.__extends)(t,e),t.prototype.componentWillUnmount=function(){var t;null===(t=e.prototype.componentWillUnmount)||void 0===t||t.call(this),this.context.unRegisterComponent(this)},t.contextType=o.MzX,(0,r.__decorate)([(0,o.A49)({type:"office-viewer"}),(0,r.__metadata)("design:paramtypes",[Object,Object])],t)}(s)}}]);