"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[8615],{58615:function(e,t,n){n.r(t),n.d(t,{TreeSelectControlRenderer:function(){return h},default:function(){return c}});var a=n(31635),o=n(96540),i=n(5917),r=n(25627),l=n(51545),s=n(38221),d=n.n(s),p=n(40961),u=n(66283),c=function(e){function t(t){var n=e.call(this,t)||this;return n.container=o.createRef(),n.input=o.createRef(),n.cache={},n.targetRef=function(e){return n.target=e?(0,p.findDOMNode)(e):null},n.sourceLoaded=!1,n.state={inputValue:"",tempValue:"",isOpened:!1},n.open=n.open.bind(n),n.close=n.close.bind(n),n.handleChange=n.handleChange.bind(n),n.handleTempChange=n.handleTempChange.bind(n),n.handleConfirm=n.handleConfirm.bind(n),n.clearValue=n.clearValue.bind(n),n.handleFocus=n.handleFocus.bind(n),n.handleBlur=n.handleBlur.bind(n),n.handleKeyPress=n.handleKeyPress.bind(n),n.handleInputChange=d()(n.handleInputChange.bind(n),150,{trailing:!0,leading:!1}),n.handleInputKeyDown=n.handleInputKeyDown.bind(n),n.loadRemote=d()(n.loadRemote.bind(n),250,{trailing:!0,leading:!1}),n}return(0,a.__extends)(t,e),t.prototype.componentDidMount=function(){this.loadRemote("")},t.prototype.componentWillUnmount=function(){this.sourceLoaded=!1},t.prototype.open=function(e){this.props.disabled||this.setState({isOpened:!0},e)},t.prototype.close=function(){var e=this;this.setState({isOpened:!1,inputValue:this.props.multiple?this.state.inputValue:""},function(){return e.loadRemote(e.state.inputValue)})},t.prototype.resolveOptions=function(){var e=this.props,t=e.options,n=e.searchable,a=e.autoComplete;return!(0,i.Amo)(a)&&n&&this.state.inputValue?this.filterOptions(t,this.state.inputValue):t},t.prototype.resolveOption=function(e,t){var n=this;return(0,i.cym)(e,function(e){var a=n.props.valueField||"value";return((0,i.Bdw)(e,a)?e[a]:"")===t})},t.prototype.handleFocus=function(e){var t=this.props,n=t.dispatchEvent,a=t.value,o=this.resolveOptions(),r=this.resolveOption(o,a);n("focus",(0,i.RKM)(this.props,{value:a,item:r,items:o}))},t.prototype.handleBlur=function(e){var t=this.props,n=t.dispatchEvent,a=t.value,o=this.resolveOptions(),r=this.resolveOption(o,a);n("blur",(0,i.RKM)(this.props,{value:a,item:r,items:o}))},t.prototype.handleKeyPress=function(e){" "===e.key&&e.shiftKey&&(this.handleOutClick(e),e.preventDefault())},t.prototype.validate=function(){var e=this.props,t=e.value,n=e.minLength,a=e.maxLength,o=e.delimiter,i=Array.isArray(t)?t:(t?String(t):"").split(o||",");return n&&i.length<n?"已选择数量低于设定的最小个数".concat(n,"，请选择更多的选项。"):a&&i.length>a?"已选择数量超出设定的最大个数".concat(a,"，请取消选择超出的选项。"):void 0},t.prototype.removeItem=function(e,t){var n=this.props,a=n.selectedOptions,o=n.joinValues,i=n.extractValue,r=n.delimiter,l=n.valueField,s=n.onChange,d=n.disabled;if(t&&t.stopPropagation(),!d){var p=a.concat();p.splice(e,1);var u=p;o?u=p.map(function(e){return e[l||"value"]}).join(r||","):i&&(u=p.map(function(e){return e[l||"value"]})),s(u)}},t.prototype.handleChange=function(e){var t=this;this.props.multiple||this.close(),this.setState({inputValue:""},function(){return t.resultChangeEvent(e)})},t.prototype.handleTempChange=function(e){this.setState({tempValue:e})},t.prototype.handleConfirm=function(){var e=this;this.close(),this.setState({inputValue:""},function(){return e.resultChangeEvent(e.state.tempValue)})},t.prototype.handleInputChange=function(e){var t=this,n=this.props,a=n.autoComplete,o=n.data;this.setState({inputValue:e},(0,i.Amo)(a,o)?function(){return t.loadRemote(t.state.inputValue)}:void 0)},t.prototype.handleInputKeyDown=function(e){var t=this.state.inputValue,n=this.props,a=n.multiple,o=n.selectedOptions;"Backspace"===e.key&&!t&&o.length&&a&&this.removeItem(o.length-1)},t.prototype.resetValue=function(){var e,t,n=this.props,a=n.onChange,o=n.resetValue,r=n.formStore,l=n.store,s=n.name;a(null!==(t=(0,i.dnO)(null!==(e=null==r?void 0:r.pristine)&&void 0!==e?e:null==l?void 0:l.pristine,s))&&void 0!==t?t:o)},t.prototype.clearValue=function(){var e=this.props,t=e.onChange,n=e.resetValue;t(void 0===n?"":n)},t.prototype.filterOptions=function(e,t){var n=this,o=this.props,i=o.labelField,r=o.valueField;return e.map(function(e){if((e=(0,a.__assign)({},e)).visible=!!(0,l.matchSorter)([e],t,{keys:[i||"label",r||"value"],threshold:l.matchSorter.rankings.CONTAINS}).length,!e.visible&&e.children){e.children=n.filterOptions(e.children,t);var o=e.children.filter(function(e){return e.visible}).length;e.visible=!!o}return e.visible&&(e.collapsed=!1),e})},t.prototype.loadRemote=function(e){return(0,a.__awaiter)(this,void 0,void 0,function(){var t,n,o,r,l,s,d,p,u,c;return(0,a.__generator)(this,function(h){switch(h.label){case 0:if(t=this.props,n=t.autoComplete,o=t.env,r=t.data,l=t.setOptions,s=t.setLoading,d=t.source,!(0,i.Amo)(n,r)||!e&&(0,i.Amo)(d)&&!this.sourceLoaded)return this.sourceLoaded=!0,[2];if(!o||!o.fetcher)throw new Error("fetcher is required");if(this.cache[e]||~e.indexOf("'"))return u=this.cache[e]||[],c=this.mergeOptions(u),l(c),[2,Promise.resolve({options:c})];s(!0),h.label=1;case 1:return h.trys.push([1,,3,4]),[4,o.fetcher(n,(0,a.__assign)((0,a.__assign)({},r),{term:e,value:e}))];case 2:return p=h.sent(),u=p.data&&p.data.options||p.data||[],this.cache[e]=u,c=this.mergeOptions(u),l(c),[2,{options:c}];case 3:return s(!1),[7];case 4:return[2]}})})},t.prototype.mergeOptions=function(e){var t=this.props.selectedOptions,n=(0,i.a5s)(e).concat();return Array.isArray(t)&&t.length&&t.forEach(function(e){(0,i.cym)(n,function(t){return t.value==e.value})||n.push((0,a.__assign)({},e))}),n},t.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},t.prototype.handleOutClick=function(e){e.defaultPrevented||this.setState({isOpened:!0})},t.prototype.handleResultChange=function(e){var t=this.props,n=t.joinValues,a=t.extractValue,o=t.delimiter,i=t.valueField,r=t.multiple,l=Array.isArray(e)?e.concat():[];r||l.length?((n||a)&&(l=e.map(function(e){return e[i||"value"]})),n&&(l=l.join(o||",")),this.resultChangeEvent(l)):this.resultChangeEvent("")},t.prototype.doAction=function(e,t,n){var a,o,i,r,l;"clear"===e.actionType?this.clearValue():"reset"===e.actionType?this.resetValue():"add"===e.actionType?this.addItemFromAction(null===(a=e.args)||void 0===a?void 0:a.item,null===(o=e.args)||void 0===o?void 0:o.parentValue):"edit"===e.actionType?this.editItemFromAction(null===(i=e.args)||void 0===i?void 0:i.item,null===(r=e.args)||void 0===r?void 0:r.originValue):"delete"===e.actionType?this.deleteItemFromAction(null===(l=e.args)||void 0===l?void 0:l.value):"reload"===e.actionType&&this.reload()},t.prototype.addItemFromAction=function(e,t){var n=this.props,a=n.onAdd,o=n.options,r=n.valueField,l=(0,i.iXH)(o,function(e){var n=r||"value";return((0,i.Bdw)(e,n)?e[n]:"")===t})||[];a&&a(l.concat(0),e,!0)},t.prototype.editItemFromAction=function(e,t){var n=this.props,o=n.onEdit,i=n.options,r=this.resolveOption(i,t);o&&r&&o((0,a.__assign)((0,a.__assign)({},e),{originValue:t}),r,!0)},t.prototype.deleteItemFromAction=function(e){var t=this.props,n=t.onDelete,a=t.options,o=this.resolveOption(a,e);n&&o&&n(o)},t.prototype.resultChangeEvent=function(e){return(0,a.__awaiter)(this,void 0,void 0,function(){var t,n,o,r,l,s;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return t=this.props,n=t.onChange,o=t.dispatchEvent,r=this.resolveOptions(),l=this.resolveOption(r,e),[4,o("change",(0,i.RKM)(this.props,{value:e,item:l,items:this.resolveOptions()}))];case 1:return(null==(s=a.sent())?void 0:s.prevented)||n&&n(e),[2]}})})},t.prototype.handleNodeClick=function(e){return(0,a.__awaiter)(this,void 0,void 0,function(){var t,n,o,r;return(0,a.__generator)(this,function(a){switch(a.label){case 0:return t=this.props,n=t.dispatchEvent,o=t.data,[4,n("itemClick",(0,i.ed2)(o,{item:e}))];case 1:return null==(r=a.sent())||r.prevented,[2]}})})},t.prototype.renderOptionItem=function(e,t){var n=this.props,o=n.menuTpl,r=n.render,l=n.data;return r("option/".concat(t.index),o,{data:(0,i.ed2)((0,i.ed2)(l,(0,a.__assign)({},t)),e)})},t.prototype.renderItem=function(e){var t=this.props,n=t.labelField,a=t.options;if(t.hideNodePathLabel)return e[n||"label"];var o=(0,i.fw2)(a,e,!0);return"".concat(o?o.map(function(e){return"".concat(e[n||"label"])}).join(" / "):e[n||"label"])},t.prototype.domRef=function(e){this.treeRef=e},t.prototype.renderOuter=function(){var e=this.props,t=e.value,n=e.enableNodePath,l=e.pathSeparator,s=void 0===l?"/":l,d=e.disabled,p=e.joinValues,u=e.extractValue,c=e.delimiter,h=(e.placeholder,e.options),m=e.multiple,v=e.valueField,_=e.initiallyOpen,f=e.unfoldedLevel,g=e.withChildren,y=e.rootLabel,C=e.cascade,b=e.rootValue,O=e.showIcon,I=e.showRadio,V=(e.popOverContainer,e.onlyChildren),F=e.onlyLeaf,T=e.classPrefix,A=e.optionsPlaceholder,w=e.searchable,R=e.autoComplete,P=e.maxLength,S=e.minLength,E=e.labelField,x=e.deferField,j=e.nodePath,k=e.onAdd,D=e.creatable,L=e.createTip,N=e.addControls,K=e.onEdit,B=e.editable,H=e.editTip,M=e.editControls,U=e.removable,z=e.removeTip,W=e.onDelete,q=e.rootCreatable,J=e.rootCreateTip,Q=e.translate,X=e.deferLoad,$=e.expandTreeOptions,G=e.selfDisabledAffectChildren,Y=e.showOutline,Z=e.autoCheckChildren,ee=e.autoCancelParent,te=e.hideRoot,ne=e.virtualThreshold,ae=e.itemHeight,oe=e.menuTpl,ie=e.enableDefaultIcon,re=e.mobileUI,le=e.testIdBuilder,se=e.nodeBehavior,de=e.itemActions,pe=e.classnames,ue=e.id,ce=e.themeCss,he=!(0,i.Amo)(R)&&w&&this.state.inputValue?this.filterOptions(h,this.state.inputValue):h;return o.createElement(r.PH,{classPrefix:T,onRef:this.domRef,onlyChildren:V,onHandleNodeClick:this.handleNodeClick,onlyLeaf:F,labelField:E,valueField:v,deferField:x,disabled:d,onChange:re?this.handleTempChange:this.handleChange,joinValues:p,extractValue:u,delimiter:c,placeholder:Q(A),options:he,highlightTxt:this.state.inputValue,multiple:m,initiallyOpen:_,unfoldedLevel:f,withChildren:g,autoCheckChildren:Z,autoCancelParent:ee,rootLabel:Q(y),rootValue:b,showIcon:O,showRadio:I,showOutline:Y,cascade:C,foldedField:"collapsed",hideRoot:te,value:t||"",nodePath:j,enableNodePath:n,pathSeparator:s,maxLength:P,minLength:S,onAdd:k,creatable:D,createTip:L,rootCreatable:q,rootCreateTip:J,onEdit:K,editable:B,editTip:H,removable:U,removeTip:z,onDelete:W,bultinCUD:!N&&!M,onDeferLoad:X,onExpandTree:$,selfDisabledAffectChildren:G,virtualThreshold:ne,itemHeight:(0,i.Roz)(ae)>0?(0,i.Roz)(ae):void 0,itemRender:oe?this.renderOptionItem:void 0,enableDefaultIcon:ie,mobileUI:re,nodeBehavior:se,itemActionsRender:de?this.renderItemActions:void 0,actionClassName:pe((0,i.NH8)((0,a.__assign)((0,a.__assign)({},this.props),{name:"actionControlClassName",id:ue,themeCss:ce}))),testIdBuilder:le})},t.prototype.renderItemActions=function(e,t){var n=this.props,o=n.itemActions,r=n.data;return(0,n.render)("action/".concat(t.index),o||"",{data:(0,i.ed2)((0,i.ed2)(r,(0,a.__assign)({},t)),e)})},t.prototype.render=function(){var e=this,t=this.props,n=t.className,l=(t.style,t.disabled),s=t.inline,d=t.loading,p=t.multiple,u=(t.value,t.clearable),c=t.classPrefix,h=t.classnames,m=t.searchable,v=t.autoComplete,_=t.selectedOptions,f=t.placeholder,g=t.popOverContainer,y=t.mobileUI,C=t.maxTagCount,b=t.overflowTagPopover,O=t.translate,I=t.env,V=t.loadingConfig,F=t.testIdBuilder,T=t.wrapperCustomStyle,A=t.id,w=t.themeCss,R=this.state.isOpened,P=p?_:_.length?this.renderItem(_[0]):"";return o.createElement(o.Fragment,null,o.createElement("div",(0,a.__assign)({ref:this.container,className:h("TreeSelectControl",n)},null==F?void 0:F.getTestId()),o.createElement(r.dM,{popOverContainer:g||I.getModalContainer,maxTagCount:C,overflowTagPopover:b,disabled:l,ref:this.targetRef,placeholder:O(null!=f?f:"placeholder.empty"),inputPlaceholder:"",className:h("TreeSelect",{"TreeSelect--inline":s,"TreeSelect--single":!p,"TreeSelect--multi":p,"TreeSelect--searchable":m||(0,i.Amo)(v),"is-opened":this.state.isOpened,"is-disabled":l}),result:P,onResultClick:this.handleOutClick,value:this.state.inputValue,onChange:this.handleInputChange,onResultChange:this.handleResultChange,itemRender:this.renderItem,onKeyPress:this.handleKeyPress,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyDown:this.handleInputKeyDown,clearable:u,allowInput:!y&&(m||(0,i.Amo)(v))&&(p||!P),hasDropDownArrow:!0,readOnly:y,mobileUI:y,testIdBuilder:null==F?void 0:F.getChild("result-box")},d?o.createElement(r.y$,{loadingConfig:V,size:"sm"}):void 0),!y&&R?o.createElement(i.hJs,{container:g||function(){return e.container.current},target:function(){return e.target},show:!0},o.createElement(i.Kx3,{classPrefix:c,className:"".concat(c,"TreeSelect-popover"),style:{minWidth:this.target?this.target.offsetWidth:void 0},onHide:this.close,overlay:!0},this.renderOuter())):null,y?o.createElement(r.HH,{container:I.getModalContainer,className:h("".concat(c,"TreeSelect-popup")),isShow:R,onHide:this.close,showConfirm:!0,onConfirm:this.handleConfirm},this.renderOuter()):null),o.createElement(i.z4D,(0,a.__assign)({},this.props,{config:{wrapperCustomStyle:T,id:A,themeCss:w,classNames:[{key:"actionControlClassName"}]},env:I})))},t.defaultProps={hideRoot:!0,placeholder:"Select.placeholder",optionsPlaceholder:"placeholder.noData",multiple:!1,clearable:!0,rootLabel:"Tree.root",rootValue:"",showIcon:!0,joinValues:!0,extractValue:!1,delimiter:",",resetValue:"",hideNodePathLabel:!1,enableNodePath:!1,pathSeparator:"/",selfDisabledAffectChildren:!0},(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"handleOutClick",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Array]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"handleResultChange",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object,Object]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"addItemFromAction",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object,Object]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"editItemFromAction",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"deleteItemFromAction",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",Promise)],t.prototype,"resultChangeEvent",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",Promise)],t.prototype,"handleNodeClick",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object,Object]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"renderOptionItem",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"renderItem",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"domRef",null),(0,a.__decorate)([i.d6t,(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[Object,Object]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"renderItemActions",null),(0,a.__decorate)([(0,u.E)(),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[]),(0,a.__metadata)("design:returntype",void 0)],t.prototype,"render",null),t}(o.Component),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,a.__extends)(t,e),(0,a.__decorate)([(0,i.QqA)({type:"tree-select"})],t)}(c)}}]);