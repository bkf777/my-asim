"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[8194],{98194:function(t,e,a){a.r(e),a.d(e,{IFrameRenderer:function(){return i},default:function(){return o}});var s=a(31635),n=a(96540),r=a(5917),o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.IFrameRef=n.createRef(),e.state={width:e.props.width||"100%",height:e.props.height||"100%"},e}return(0,s.__extends)(e,t),e.prototype.componentDidMount=function(){window.addEventListener("message",this.onMessage)},e.prototype.componentDidUpdate=function(t){var e=this.props.data;e!==t.data?this.postMessage("update",e):this.props.width===t.width&&this.props.height===t.height||this.setState({width:this.props.width||"100%",height:this.props.height||"100%"})},e.prototype.componentWillUnmount=function(){window.removeEventListener("message",this.onMessage)},e.prototype.validateURL=function(t){return!(!t||"string"!=typeof t||!/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9]+);base64,.*/.test(t))||!(t&&"string"==typeof t&&!/^(\.\/|\.\.\/|\/|(blob\:)?https?\:\/\/|\/\/)/.test(t))},e.prototype.onMessage=function(t){var e,a,n;return(0,s.__awaiter)(this,void 0,void 0,function(){var o,i,d,p,c,l,h,m,u,_,g;return(0,s.__generator)(this,function(v){switch(v.label){case 0:return o=this.props,i=o.events,d=o.onEvent,p=o.onAction,c=o.data,"string"!=typeof(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.type)?[2]:(l=(0,s.__read)(t.data.type.split(":"),2),h=l[0],m=l[1],"amis"===h&&m?"resize"===m&&t.data.data?(this.setState({width:t.data.data.width||"100%",height:t.data.data.height||"100%"}),[3,4]):[3,1]:[2]);case 1:return(u=null==d?void 0:d[m])&&(null===(a=u.actions)||void 0===a?void 0:a.length)?(_=(0,r.ESp)(m,{env:null===(n=this.props)||void 0===n?void 0:n.env,nativeEvent:t,data:(0,r.ed2)(c,t.data.data),scoped:this.context}),[4,(0,r.L9B)(u.actions,this,_)]):[3,3];case 2:if(v.sent(),_.prevented)return[2];v.label=3;case 3:i&&(g=i[m])&&p(t,g,(0,r.ed2)(c,t.data.data)),v.label=4;case 4:return[2]}})})},e.prototype.onLoad=function(){var t=this.props,e=t.src,a=t.data;e&&this.postMessage("init",a)},e.prototype.reload=function(t,e){if(e)return this.receive(e);var a=this.props,s=a.src,n=a.data;s&&(this.IFrameRef.current.src=(0,r.GvO)(s,n,"| raw"))},e.prototype.receive=function(t){var e=this.props,a=e.src,s=e.data,n=(0,r.ed2)(s,t);this.postMessage("receive",n),(0,r.B92)(a,a,s,n)&&(this.IFrameRef.current.src=(0,r.GvO)(a,n,"| raw"))},e.prototype.postMessage=function(t,e){var a,s;null===(s=null===(a=this.IFrameRef.current)||void 0===a?void 0:a.contentWindow)||void 0===s||s.postMessage({type:"amis:".concat(t),data:JSON.parse(JSON.stringify(e))},"*")},e.prototype.render=function(){var t=this.state,e=t.width,a=t.height,o=this.props,i=o.className,d=o.src,p=o.name,c=o.frameBorder,l=o.data,h=o.style,m=o.allow,u=o.sandbox,_=o.referrerpolicy,g=o.translate,v=o.id,y=o.wrapperCustomStyle,f=o.env,w=o.themeCss,b=(o.baseControlClassName,o.classnames),C={};void 0!==e&&(C.width=e),void 0!==a&&(C.height=a),h=(0,s.__assign)((0,s.__assign)({},C),h);var F=d?(0,r.GvO)(d,l,"| raw"):void 0;return this.validateURL(F)?("https:"===location.protocol&&F&&F.startsWith("http://")&&f.notify("error",g("Iframe.invalidProtocol")),n.createElement(n.Fragment,null,n.createElement("iframe",{name:p,className:b("IFrame",i,(0,r.NH8)((0,s.__assign)((0,s.__assign)({},this.props),{name:"baseControlClassName",id:v,themeCss:w})),(0,r.NH8)((0,s.__assign)((0,s.__assign)({},this.props),{name:"wrapperCustomStyle",id:v,themeCss:y}))),frameBorder:c,style:h,ref:this.IFrameRef,onLoad:this.onLoad,src:F,allow:m,referrerPolicy:_,sandbox:u}),n.createElement(r.z4D,(0,s.__assign)({},this.props,{config:{wrapperCustomStyle:y,id:v,themeCss:w,classNames:[{key:"baseControlClassName"}]},env:f})))):n.createElement("p",null,g("Iframe.invalid"))},e.propsList=["src","className"],e.defaultProps={className:"",frameBorder:0},(0,s.__decorate)([r.d6t,(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[MessageEvent]),(0,s.__metadata)("design:returntype",Promise)],e.prototype,"onMessage",null),(0,s.__decorate)([r.d6t,(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],e.prototype,"onLoad",null),(0,s.__decorate)([r.d6t,(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object,Object]),(0,s.__metadata)("design:returntype",void 0)],e.prototype,"reload",null),(0,s.__decorate)([r.d6t,(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],e.prototype,"receive",null),(0,s.__decorate)([r.d6t,(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[String,Object]),(0,s.__metadata)("design:returntype",void 0)],e.prototype,"postMessage",null),e}(n.Component),i=function(t){function e(e,a){var s=t.call(this,e)||this;return a.registerComponent(s),s}return(0,s.__extends)(e,t),e.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),t.prototype.componentWillUnmount.call(this)},e.contextType=r.MzX,(0,s.__decorate)([(0,r.A49)({type:"iframe"}),(0,s.__metadata)("design:paramtypes",[Object,Object])],e)}(o)}}]);