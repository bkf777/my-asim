"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[3187],{33187:function(e,t,i){i.r(t),i.d(t,{TreeControlRenderer:function(){return f},default:function(){return g}});var n=i(31635),o=i(96540),r=i(90179),a=i.n(r),l=i(38221),s=i.n(l),d=i(32485),p=i.n(d),c=i(51545),h=i(25627),u=i(41376),m=i(5917),v=i(66283),g=function(e){function t(t){var i,n=this;return(n=e.call(this,t)||this).rootRef=o.createRef(),n.state={keyword:"",filteredOptions:null!==(i=n.props.options)&&void 0!==i?i:[],allowSearch:!1,virtualListHeight:0,othersHeight:0},n.handleSearch=s()(n.handleSearch.bind(n),250,{trailing:!0,leading:!1}),n}return(0,n.__extends)(t,e),t.prototype.componentDidMount=function(){var e,t=this;this.props.heightAuto&&(this.initOthersHeight(),this.handleVirtualListHeight(),this.unSensor=(0,m.zMn)(null===(e=this.rootRef.current)||void 0===e?void 0:e.parentElement,function(){t.handleVirtualListHeight()},!1,"height"))},t.prototype.componentDidUpdate=function(e,t){var i=this.props,n=this.state,o=this.state.keyword;if(e.options!==i.options||e.searchable!==i.searchable){var r=i.options,a=i.searchable;this.setState({filteredOptions:a&&o?this.filterOptions(r,o):r})}(0,m.TIf)(["label","searchable","creatable","hideRoot","themeCss","wrapperCustomStyle","heightAuto"],e,i)&&i.heightAuto&&this.initOthersHeight(),t.othersHeight!==n.othersHeight&&i.heightAuto&&this.handleVirtualListHeight()},t.prototype.componentWillUnmount=function(){this.unSensor&&(this.unSensor(),delete this.unSensor)},t.prototype.initOthersHeight=function(){var e,t,i=this,n=this.rootRef.current,o=null===(e=this.rootRef.current)||void 0===e?void 0:e.parentElement,r=this.treeRef.virtualListRef.current,a=null===(t=this.treeRef.virtualListRef.current)||void 0===t?void 0:t.parentElement;if(o&&a&&r&&n){var l=function(e,t){return Array.from(e.children).filter(function(e){return e!==t}).reduce(function(e,t){return e+t.offsetHeight+i.getElementVerticalMargin(t)},0)},s=l(o,n)+this.getElementVerticalMargin(n)+l(a,r)+n.offsetHeight-a.offsetHeight;this.setState({othersHeight:s})}},t.prototype.handleVirtualListHeight=function(){var e,t=this.state.othersHeight,i=null===(e=this.rootRef.current)||void 0===e?void 0:e.parentElement;if(i){var n=i.offsetHeight-t;this.setState({virtualListHeight:n>0?n:0})}},t.prototype.getElementVerticalMargin=function(e){var t=window.getComputedStyle(e,null);return parseInt(t.marginTop||"0")+parseInt(t.marginBottom||"0")},t.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},t.prototype.doAction=function(e,t,i){var n,o,r,a,l,s,d,p,c,h,u,v=null==e?void 0:e.actionType,g=this.props,f=g.resetValue,_=g.onChange,y=g.formStore,b=g.store,C=g.name;if("clear"===v)null==_||_("");else if("reset"===v){var w=null!==(o=(0,m.dnO)(null!==(n=null==y?void 0:y.pristine)&&void 0!==n?n:null==b?void 0:b.pristine,C))&&void 0!==o?o:f;null==_||_(null!=w?w:"")}else"expand"===e.actionType?this.treeRef.syncUnFolded(this.props,null===(r=e.args)||void 0===r?void 0:r.openLevel):"collapse"===e.actionType?this.treeRef.syncUnFolded(this.props,(null===(a=e.args)||void 0===a?void 0:a.closeLevel)||0):"add"===e.actionType?this.addItemFromAction(null===(l=e.args)||void 0===l?void 0:l.item,null===(s=e.args)||void 0===s?void 0:s.parentValue):"edit"===e.actionType?this.editItemFromAction(null===(d=e.args)||void 0===d?void 0:d.item,null===(p=e.args)||void 0===p?void 0:p.originValue):"delete"===e.actionType?this.deleteItemFromAction(null===(c=e.args)||void 0===c?void 0:c.value):"reload"===e.actionType?this.reload():"search"===v&&(this.setState({allowSearch:!!(null===(h=e.args)||void 0===h?void 0:h.keyword)}),this.handleSearch(null===(u=e.args)||void 0===u?void 0:u.keyword))},t.prototype.resolveOption=function(e,t){var i=this;return(0,m.cym)(e,function(e){var n=i.props.valueField||"value";return((0,m.Bdw)(e,n)?e[n]:"")===t})},t.prototype.addItemFromAction=function(e,t){var i=this.props,n=i.onAdd,o=i.options,r=i.valueField,a=(0,m.iXH)(o,function(e){var i=r||"value";return((0,m.Bdw)(e,i)?e[i]:"")===t})||[];n&&n(a.concat(0),e,!0)},t.prototype.editItemFromAction=function(e,t){var i=this.props,o=i.onEdit,r=i.options,a=this.resolveOption(r,t);o&&a&&o((0,n.__assign)((0,n.__assign)({},e),{originValue:t}),a,!0)},t.prototype.deleteItemFromAction=function(e){var t=this.props,i=t.onDelete,n=t.options,o=this.resolveOption(n,e);i&&o&&i(o)},t.prototype.filterOptions=function(e,t){var i=this,o=this.props,r=o.labelField,a=o.valueField;return e.map(function(e){if((e=(0,n.__assign)({},e)).visible=!!(0,c.matchSorter)([e],t,{keys:[r||"label",a||"value"],threshold:c.matchSorter.rankings.CONTAINS}).length,!e.visible&&e.children){e.children=i.filterOptions(e.children,t);var o=e.children.filter(function(e){return e.visible}).length;e.visible=!!o}return e.visible&&(e.collapsed=!1),e})},t.prototype.handleChange=function(e){return(0,n.__awaiter)(this,void 0,void 0,function(){var t,i,o,r,a,l,s,d,p,c,h,v,g,f,_,y,b,C;return(0,n.__generator)(this,function(n){switch(n.label){case 0:return t=this.props,i=t.onChange,o=t.searchable,r=t.options,a=t.dispatchEvent,l=t.multiple,s=t.delimiter,d=t.valueField,p=t.selectedOptions,c=t.joinValues,h=t.extractValue,v=this.state,g=v.filteredOptions,f=v.allowSearch,_=o||f?g:r,y=(0,u.R2)(e,{multiple:l,delimiter:s,valueField:d,options:g}),b=l?null:y[0],l&&(o||f)&&p.length&&(p.forEach(function(e){var t=(0,m.cym)(g,function(t){return t[d||"value"]===e[d||"value"]});t||y.push(e)}),e=y.map(function(e){return h||c?e[d||"value"]:e}),c&&(e=e.join(s||","))),[4,a("change",(0,m.RKM)(this.props,{value:e,item:b,items:_,selectedItems:y}))];case 1:return(null==(C=n.sent())?void 0:C.prevented)||i&&i(e),[2]}})})},t.prototype.handleNodeClick=function(e){return(0,n.__awaiter)(this,void 0,void 0,function(){var t,i,o,r;return(0,n.__generator)(this,function(n){switch(n.label){case 0:return t=this.props,i=t.dispatchEvent,o=t.data,[4,i("itemClick",(0,m.ed2)(o,{item:e}))];case 1:return null==(r=n.sent())||r.prevented,[2]}})})},t.prototype.handleSearch=function(e){return(0,n.__awaiter)(this,void 0,void 0,function(){var t,i,o,r,a,l,s,d,p,c;return(0,n.__generator)(this,function(n){switch(n.label){case 0:if(t=this.props,i=t.searchApi,o=t.options,r=t.env,a=t.data,l=t.translate,s=[],!(0,m.Amo)(i))return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,r.fetcher(i,(0,m.ed2)(a,{term:e}))];case 2:if(!(d=n.sent()).ok)throw new Error(l(d.msg||"networkError"));if(p=d.data.options||d.data.items||d.data,!Array.isArray(p))throw new Error(l("Tree.invalidArray"));return s=p,[3,4];case 3:return c=n.sent(),r.isCancel(c)||!i.silent&&r.notify("error",c.message),[3,4];case 4:return[3,6];case 5:e&&(s=this.filterOptions(o,e)),n.label=6;case 6:return this.setState({keyword:e,filteredOptions:e?s:o}),[2]}})})},t.prototype.domRef=function(e){this.treeRef=e},t.prototype.validate=function(){var e=this.props,t=e.value,i=e.minLength,n=e.maxLength,o=e.delimiter,r=Array.isArray(t)?t:(t?String(t):"").split(o||",");return i&&r.length<i?"已选择数量低于设定的最小个数".concat(i,"，请选择更多的选项。"):n&&r.length>n?"已选择数量超出设定的最大个数".concat(n,"，请取消选择超出的选项。"):void 0},t.prototype.renderOptionItem=function(e,t){var i=this.props,o=i.menuTpl,r=i.render,a=i.data;return r("option/".concat(t.index),o,{data:(0,m.ed2)((0,m.ed2)(a,(0,n.__assign)({},t)),e)})},t.prototype.renderItemActions=function(e,t){var i=this.props,o=i.itemActions,r=i.data;return(0,i.render)("action/".concat(t.index),o||"",{data:(0,m.ed2)((0,m.ed2)(r,(0,n.__assign)({},t)),e)})},t.prototype.renderSearch=function(){var e=this.props,t=e.classPrefix,i=e.searchConfig,r=e.mobileUI,l=e.testIdBuilder;return o.createElement(h.Gd,(0,n.__assign)({className:p()("".concat(t,"TreeControl-searchbox"),null==i?void 0:i.className,{"is-sticky":null==i?void 0:i.sticky}),mini:!1,clearable:!0},a()(i,"className","sticky"),{onSearch:this.handleSearch,mobileUI:r,testIdBuilder:null==l?void 0:l.getChild("search")}))},t.prototype.render=function(){var e=this.props,t=e.className,i=e.treeContainerClassName,r=e.classPrefix,a=e.value,l=e.enableNodePath,s=e.pathSeparator,d=void 0===s?"/":s,c=e.disabled,u=e.joinValues,v=e.extractValue,g=e.delimiter,f=e.placeholder,_=e.options,y=e.multiple,b=e.valueField,C=e.initiallyOpen,w=e.unfoldedLevel,O=e.withChildren,F=e.onlyChildren,A=e.onlyLeaf,I=e.loading,S=e.hideRoot,R=e.rootLabel,T=e.autoCheckChildren,k=e.autoCancelParent,H=e.cascade,E=e.rootValue,L=e.showIcon,N=e.showRadio,V=e.showOutline,j=e.onAdd,x=e.creatable,P=e.createTip,D=e.addControls,B=e.onEdit,U=e.editable,z=e.editTip,M=e.editControls,G=e.removable,q=e.removeTip,K=e.onDelete,Q=e.rootCreatable,W=e.rootCreateTip,X=e.labelField,$=e.iconField,J=e.deferField,Y=e.nodePath,Z=e.deferLoad,ee=e.expandTreeOptions,te=e.translate,ie=e.data,ne=e.virtualThreshold,oe=e.itemHeight,re=e.loadingConfig,ae=e.menuTpl,le=e.enableDefaultIcon,se=e.searchable,de=e.searchConfig,pe=void 0===de?{}:de,ce=e.heightAuto,he=e.mobileUI,ue=e.testIdBuilder,me=e.nodeBehavior,ve=e.itemActions,ge=e.id,fe=e.wrapperCustomStyle,_e=e.themeCss,ye=e.env,be=this.props.highlightTxt,Ce=this.state,we=Ce.filteredOptions,Oe=Ce.keyword,Fe=Ce.allowSearch,Ae=Ce.virtualListHeight;(0,m.joH)(be)&&(be=(0,m.GvO)(be,ie));var Ie=o.createElement(h.PH,{classPrefix:r,onRef:this.domRef,labelField:X,valueField:b,iconField:$,deferField:J,disabled:c,onChange:this.handleChange,onHandleNodeClick:this.handleNodeClick,joinValues:u,extractValue:v,delimiter:g,placeholder:te(f),options:se||Fe?we:_,highlightTxt:se||Fe?Oe:be,multiple:y,initiallyOpen:C,unfoldedLevel:w,withChildren:O,onlyChildren:F,onlyLeaf:A,hideRoot:S,rootLabel:te(R),rootValue:E,showIcon:L,showRadio:N,showOutline:V,autoCheckChildren:T,autoCancelParent:k,cascade:H,foldedField:"collapsed",value:a||"",nodePath:Y,enableNodePath:l,pathSeparator:d,selfDisabledAffectChildren:!1,onAdd:j,creatable:x,createTip:P,rootCreatable:Q,rootCreateTip:W,onEdit:B,editable:U,editTip:z,removable:G,removeTip:q,onDelete:K,bultinCUD:!D&&!M,onDeferLoad:Z,onExpandTree:ee,virtualThreshold:ne,virtualHeight:(0,m.Roz)(Ae)>=0?(0,m.Roz)(Ae):void 0,itemHeight:(0,m.Roz)(oe)>0?(0,m.Roz)(oe):void 0,itemRender:ae?this.renderOptionItem:void 0,enableDefaultIcon:le,mobileUI:he,nodeBehavior:me,itemActionsRender:ve?this.renderItemActions:void 0,actionClassName:p()((0,m.NH8)((0,n.__assign)((0,n.__assign)({},this.props),{name:"actionControlClassName",id:ge,themeCss:_e}))),testIdBuilder:null==ue?void 0:ue.getChild("tree")});return o.createElement(o.Fragment,null,o.createElement("div",(0,n.__assign)({ref:this.rootRef,className:p()("".concat(r,"TreeControl"),t,i,{"is-sticky":se&&(null==pe?void 0:pe.sticky),"h-auto":ce})},null==ue?void 0:ue.getChild("control").getTestId()),o.createElement(h.y$,{size:"sm",key:"info",show:I,loadingConfig:re}),I?null:se?o.createElement(o.Fragment,null,this.renderSearch(),Ie):Ie),o.createElement(m.z4D,(0,n.__assign)({},this.props,{config:{wrapperCustomStyle:fe,id:ge,themeCss:_e,classNames:[{key:"actionControlClassName"}]},env:ye})))},t.defaultProps={placeholder:"placeholder.noData",multiple:!1,rootLabel:"Tree.root",rootValue:"",showIcon:!0,enableNodePath:!1,pathSeparator:"/"},(0,n.__decorate)([m.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object,Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"addItemFromAction",null),(0,n.__decorate)([m.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object,Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"editItemFromAction",null),(0,n.__decorate)([m.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"deleteItemFromAction",null),(0,n.__decorate)([m.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",Promise)],t.prototype,"handleChange",null),(0,n.__decorate)([m.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",Promise)],t.prototype,"handleNodeClick",null),(0,n.__decorate)([m.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"domRef",null),(0,n.__decorate)([m.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object,Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"renderOptionItem",null),(0,n.__decorate)([m.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[Object,Object]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"renderItemActions",null),(0,n.__decorate)([m.d6t,(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"renderSearch",null),(0,n.__decorate)([(0,v.E)(),(0,n.__metadata)("design:type",Function),(0,n.__metadata)("design:paramtypes",[]),(0,n.__metadata)("design:returntype",void 0)],t.prototype,"render",null),t}(o.Component),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),(0,n.__decorate)([(0,m.QqA)({type:"input-tree"})],t)}(g)}}]);